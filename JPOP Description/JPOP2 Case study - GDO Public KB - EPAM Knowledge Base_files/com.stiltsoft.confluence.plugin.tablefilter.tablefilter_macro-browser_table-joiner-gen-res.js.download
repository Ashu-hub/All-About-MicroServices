WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.stiltsoft.confluence.plugin.tablefilter.tablefilter:macro-browser~table-joiner-gen-res', location = 'build/macro-browser~table-joiner.js' */
(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{11:function(e,t,a){"use strict";var l=a(7),n=a.n(l),o=a(0),r=a(14),s=a.n(r),i=new RegExp("​TFaC-sq​","g"),c=new RegExp("​TFaC-dq​","g"),p=new RegExp("​TFaC-vd​","g"),u=new RegExp("​TFaC-bs​","g"),f=new RegExp("​TFaC-vq​","g"),d=new RegExp("​TFaC-vga​","g"),m=new RegExp('"(.*?)"',"gm"),g=new RegExp("FROM (T\\d+) ((\\w* )?JOIN T\\* \\w* ((T\\d+)\\..+ = T\\*\\.(`.+?`)|([^\\s])))"),T=new RegExp("'(.+?)' AS '(.+?)'","gi"),h={normalizeSql:function(e,t){var a,l=e.sql.replace(/\n/g," ");for(l=l.replace(/\\"/g,"​TFaC-dq​"),m.lastIndex=0;a=m.exec(l);){var n=a[0].length,r=a[1].replace(c,'"'),s=o.a.getAnyValueType(r,e.separator,e.worklog,!0,e.dateFormat,e.locale);null!=s?(r=""+h.getValue(r,s,e),l=l.replace(a[0],r)):(r=a[1],new RegExp("'|`|​TFaC-dq​").test(r)&&(r='"'+r.replace(/'/g,"​TFaC-vq​").replace(/`/g,"​TFaC-vga​").replace(c,"​TFaC-vd​")+'"',l=l.replace(a[0],r))),n-=r.length,m.lastIndex===a.index&&m.lastIndex++,m.lastIndex+=n}if(-1!==(l=l.replace(c,'"').replace(/\\'/g,"​TFaC-sq​").replace(/'/g,"`").replace(/\\/g,"​TFaC-bs​")).indexOf("FROM T*")){var i=l.indexOf("FROM T*"),p=h.findParentheses(l,i),u=l,f="",d="";-1!==p.start&&-1!==p.end&&(f=l.substring(0,p.start+1),d=l.substring(p.end),u=l.substring(p.start+1,p.end));var T=[];$.each(t.jsons,(function(e){T.push(u.replace("T*",e))})),T.length&&(l=f+T.join(" UNION ALL CORRESPONDING ")+d)}if(-1!==l.indexOf("JOIN T*")&&(a=g.exec(l))){var v=a[1],x=a[2],b=[],y=[a[4]];$.each(t.jsons,(function(e,t){v!==e&&(b.push(x.replace(a[4],y.join(" OR ")).replace(/T\*/g,e)),y.push(a[4].replace(a[5],e)))})),l=l.replace(x,b.join(" "))}return l},convertTablesToJSON:function(e,t){var a={},l={};return e.tables.forEach((function(e,n){if(e.length>0){var r=e[0];r.forEach((function(e,t){e.text?-1!==r[t].text.indexOf("`")&&-1!==r[t].text.indexOf("]")&&(r[t].text=r[t].text.replace(/`/g,"'")):r[t].text="_",r[t].text=r[t].text.replace(/\\/g,"​TFaC-bs​").replace(/'/g,"​TFaC-sq​"),l[r[t].text]||(l[r[t].text]={htmlColName:r[t].html})}));var s=[],i=[],c=[];e.forEach((function(e,a){if(a>0){var n={};e.forEach((function(e,a){if(!i[a]&&e.text){var c=o.a.getAnyValueType(e.text,t.separator,t.worklog,!0,t.dateFormat,t.locale);switch(s[a]=c,c){case 0:case 1:case 2:case 3:i[a]="number";break;default:i[a]="string"}}var p;try{null===(p=e.text?h.getValue(e.text,s[a],t):null)&&e.text&&(p=e.text)}catch(t){p=e.text}n[r[a].text]=p,l[r[a].text][p]=e.html})),c.push(n)}})),r.forEach((function(e,t){i[t]||(i[t]="string",s[t]=null)})),a["T"+(n+1)]={table:c,columns:r,fieldTypes:i,types:s}}})),{jsons:a,valueViewMap:l}},prepareAlaSql:function(e,t){n.a.options.cache=!1,$.each(n.a.tables,(function(e){n()("DROP TABLE "+e)})),$.each(e.jsons,(function(e,t){var a=[];t.columns.forEach((function(e,l){var n=e.text;n=-1!==n.indexOf("`")?"["+n+"] ":"`"+n+"` ",a.push(n+t.fieldTypes[l])}));var l="CREATE TABLE "+e+" ("+a.join(", ")+")";n()(l),n.a.tables[e].data=t.table})),n.a.fn.FORMATDATE=function(e){if("number"==typeof e){var a=new Date;a.setTime(e),e=a}return o.a.formatDate(e,t.dateFormat,t.locale)},n.a.fn.FORMATTIME=function(e){return o.a.formatDuration(e)},n.a.fn.FORMATWORKLOG=function(e){return o.a.formatWorklog(e,t.worklog)}},getFormattedCols:function(e,t){var a=this,l=[],n=[];return t.forEach((function(t){$.each(t,(function(t){if(-1===n.indexOf(t))if(n.push(t),e.valueViewMap[t])l.push({html:a.cleanCellHtml(e.valueViewMap[t].htmlColName),text:t});else{var o=a.unescapeColumn(t);l.push({html:s.a.tableTh({value:o}),text:t})}}))})),l},formatResult:function(e,t,a){var l=this,n={},r=l.getAliases(a.sql);$.each(e.jsons,(function(e,t){t.columns.forEach((function(e,a){n[e.text]=t.types[a]}))})),t.forEach((function(t){$.each(t,(function(i,c){if(null!=c){void 0===n[i]&&"number"==typeof c&&(n[i]=o.a.number),t[i]={type:0===n[i]?"number":""};var m,g=r[i];(m=e.valueViewMap[i]&&e.valueViewMap[i][c]||g&&e.valueViewMap[g]&&e.valueViewMap[g][c])?t[i].html=l.cleanCellHtml(m):(null!=n[i]&&void 0!==c?(o.a.date===n[i]&&(c=new Date(c)),t[i].html=o.a.formatAnyValueByType(c,n[i],(function(e){return a.formatDecimal.to(e)}),a.worklog,a.dateFormat,a.locale),!1===t[i].html&&(t[i].html=c)):(c="string"==typeof c?c.replace(p,'"').replace(u,"\\").replace(f,"'").replace(d,"`"):c,t[i].html=c),t[i].html=s.a.tableTd({cell:t[i]}))}else t[i]={html:s.a.tableTd({cell:{html:"",type:""}}),type:""}}))}))},getValue:function(e,t,a){if(null==t)return e;var l=o.a.parseAnyValueByType(t,e,a.separator,a.worklog,!0,a.dateFormat,a.locale);return l&&o.a.date===t&&(l=l.getTime()),(isNaN(l)||null===l)&&(l=null),l},unescapeColumn:function(e){return e.replace(i,"'").replace(u,"\\").replace(p,'"').replace(f,"'").replace(d,"`")},cleanCellHtml:function(e){var t=$(e).removeClass("fake pivot-hidden-column").attr("rowspan","").attr("colspan","").css("display","");return t.removeClass(t.getClassStartsWith(/tf-rowspan-\d+/)),t.removeClass(t.getClassStartsWith(/tf-colspan-\d+/)),t.is("th")?t.addClass("confluenceTh"):t.addClass("confluenceTd"),t[0].outerHTML},findParentheses:function(e,t){for(var a=-1,l=0,n=t-1;n>=0;n--)if("("===e[n]){if(0===l){a=n;break}l--}else")"===e[n]&&l++;if(-1===a)return{start:-1,end:-1};var o=-1,r=0;for(n=t+1;n<e.length;n++)if(")"===e[n]){if(0===r){o=n;break}r--}else"("===e[n]&&r++;return{start:a,end:o}},getAliases:function(e){var t,a={};for(T.lastIndex=0;t=T.exec(e);)a[t[2]]=t[1];return a}};t.a=h},14:function(e,t){if(window.TableJoinerTemplate=window.TableJoinerTemplate||{},void 0===a)var a={};a.view=function(e,t){return'<div class="table-joiner" id="table-joiner-'+soy.$$escapeHtml(e.macroId)+'" data-id="'+soy.$$escapeHtml(e.macroId)+'" data-pageid="'+soy.$$escapeHtml(e.pageId)+'" data-sessionid="'+soy.$$escapeHtml(e.sessionId)+'" data-export-hash="'+soy.$$escapeHtml(e.exportHash)+'" data-tj-not-ready="true">'+(e.isEmail?"":(e.exportCSV||e.exportWord||e.exportPDF?'<div class="tj-exports">'+(e.exportCSV?'<button class="aui-button export-csv">'+soy.$$escapeHtml("Export to CSV")+"</button>":"")+(e.exportPDF?'<button class="aui-button export-pdf">'+soy.$$escapeHtml("Export to PDF")+"</button>":"")+(e.exportWord?'<button class="aui-button export-word">'+soy.$$escapeHtml("Export to Word")+"</button>":"")+"</div>":"")+'<div class="wrapper"><span class="loading"></span><div class="table-wrap"></div></div>')+'<div class="tj-source '+(e.showSource?"":"tj-hidden")+'">'+soy.$$filterNoAutoescape(e.body)+"</div></div>"},goog.DEBUG&&(a.view.soyTemplateName="TableJoinerTemplate.view"),a.table=function(e,t){for(var a='<table class="confluenceTable"><thead><tr>',l=e.cols,n=l.length,o=0;o<n;o++){var r=l[o];a+=soy.$$filterNoAutoescape(r.html)}a+="</tr></thead><tbody>";for(var s=e.res,i=s.length,c=0;c<i;c++){var p=s[c];a+="<tr>";for(var u=e.cols,f=u.length,d=0;d<f;d++){var m=u[d];a+=p[m.text]?soy.$$filterNoAutoescape(p[m.text].html):'<td class="confluenceTd"></td>'}a+="</tr>"}return a+="</tbody></table>"},goog.DEBUG&&(a.table.soyTemplateName="TableJoinerTemplate.table"),a.tableTh=function(e,t){return'<th class="confluenceTh">'+soy.$$escapeHtml(e.value)+"</th>"},goog.DEBUG&&(a.tableTh.soyTemplateName="TableJoinerTemplate.tableTh"),a.tableTd=function(e,t){return'<td class="confluenceTd '+soy.$$escapeHtml(e.cell.type)+'">'+soy.$$escapeHtml(e.cell.html)+"</td>"},goog.DEBUG&&(a.tableTd.soyTemplateName="TableJoinerTemplate.tableTd"),a.empty=function(e,t){return'<div class="aui-message info aui-message-info"><p>'+soy.$$escapeHtml("Oops, it seems that you need to place a table or a macro generating a table within the Table Transformer macro.")+"</p></div>"},goog.DEBUG&&(a.empty.soyTemplateName="TableJoinerTemplate.empty"),a.noResult=function(e,t){return'<div class="aui-message info aui-message-info"><p>'+soy.$$escapeHtml("The query returned no rows.")+"</p></div>"},goog.DEBUG&&(a.noResult.soyTemplateName="TableJoinerTemplate.noResult"),a.error=function(e,t){return'<div class="aui-message error aui-message-error"><p>'+soy.$$escapeHtml(e.error)+"</p></div>"},goog.DEBUG&&(a.error.soyTemplateName="TableJoinerTemplate.error"),e.exports=a}}]);
}catch(e){WRMCB(e)};