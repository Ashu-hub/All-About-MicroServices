WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.epam.confluence.plugins.automated-status-reporting:macro-status-commit-resources', location = '/js/macro-status-commit.js' */
(function(c){var a=c(document);var b=c(window);AJS.bind("init.rte",function(){var o=/(\d*)(px)?/;var k;function p(){var u=false;if(AJS.Meta.get("page-id")=="0"){u=false}else{c.ajax({url:AJS.params.contextPath+"/rest/macrostatuscommit/1.0/actions/check-if-page-allowed-to-commit",type:"POST",contentType:"application/x-www-form-urlencoded;charset=UTF-8",data:g({}),dataType:"json",async:false}).done(function(v){u=(v.value=="1")?true:false}).fail(function(v){u=false})}return u}function q(){var v=c("ul.save-button-container");if(v.length>0){v.before(Confluence.MacroStatusCommit.Templates.commitUlBtn())}else{v=c("div.save-button-container");v.before(Confluence.MacroStatusCommit.Templates.commitDivBtn())}var u=c("#rte-button-macro-status-commit");u.click(function(w){w.preventDefault();r()})}function n(){c("#rte-button-macro-status-commit").attr("disabled","disabled")}function t(){c("#rte-button-macro-status-commit").removeAttr("disabled")}function r(){if(!k){k=new AJS.Dialog(f());k.addHeader("Status Commit");k.addPanel("MacroStatusCommitPanel","macroStatusCommitPanel1");k.getCurrentPanel().html(Confluence.MacroStatusCommit.Templates.popup());k.addSubmit("Apply",l);k.addCancel("Cancel",d)}k.show();n()}function f(){return m()}function m(){return{width:400,height:300,}}function j(u){if(u){c("#macro-status-commit-form").hide();c("#macro-status-commit-inprogress-wait").hide();c("#macro-status-commit-inprogress").show();setTimeout(function(){c("#macro-status-commit-inprogress-wait").show()},10000);k.disable()}else{c("#macro-status-commit-form").show();c("#macro-status-commit-inprogress").hide();c("#macro-status-commit-inprogress-wait").hide();k.enable()}}function l(){c.ajax({url:AJS.params.contextPath+"/rest/macrostatuscommit/1.0/actions/commit",type:"POST",contentType:"application/x-www-form-urlencoded;charset=UTF-8",data:g({editorFormat:AJS.Rte.getEditor().getContent(),statusColor:c("#macro-status-commit-status-color").val()}),dataType:"json",beforeSend:function(){j(true)},async:true}).done(function(u){if(u.value=="OK"){h();n();s();c("#rte-button-cancel").click()}else{i("Commit error",u.value.replace("ERROR:",""))}}).fail(function(u){e("Commit error",u)})}function d(){s();t()}function s(){k.hide()}function h(){c("#macro-status-commit-status").empty()}function i(v,u){h();j(false);var u="<ul><li>"+AJS.escapeHtml(u)+"</li></ul>";AJS.messages.error("#macro-status-commit-status",{title:v,body:u,shadowed:false,closeable:true})}function e(x,w){var v=w.getResponseHeader("Content-Type");var u;if(/^application\/json$|^application\/json;.*/.test(v)){u=JSON.parse(w.responseText)}else{if(w.status==403){u={message:"Unauthorized request. Please re-login."}}else{u={message:"Unknown error occurred calling server."}}}i(x,u.message+" ("+w.status+")")}function g(u){return c.extend({pageId:AJS.Meta.get("page-id")},u)}if(p()){q()}})})(AJS.$);
}catch(e){WRMCB(e)};