WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/util/is-valid-uri.js' */
define("confluence-collaborative-editor-plugin/util/is-valid-uri",[],function(){var g="\\s\xA0\u1680\u2000-\u200A\u202F\u205F\u3000";var b="\\$\\+<->\\^`\\|~\xA2-\xA6\xA8\xA9\xAC\xAE-\xB1\xB4\xB8\xD7\xF7\u02C2-\u02C5\u02D2-\u02DF\u02E5-\u02EB\u02ED\u02EF-\u02FF\u0375\u0384\u0385\u03F6\u0482\u058D-\u058F\u0606-\u0608\u060B\u060E\u060F\u06DE\u06E9\u06FD\u06FE\u07F6\u09F2\u09F3\u09FA\u09FB\u0AF1\u0B70\u0BF3-\u0BFA\u0C7F\u0D4F\u0D79\u0E3F\u0F01-\u0F03\u0F13\u0F15-\u0F17\u0F1A-\u0F1F\u0F34\u0F36\u0F38\u0FBE-\u0FC5\u0FC7-\u0FCC\u0FCE\u0FCF\u0FD5-\u0FD8\u109E\u109F\u1390-\u1399\u17DB\u1940\u19DE-\u19FF\u1B61-\u1B6A\u1B74-\u1B7C\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2044\u2052\u207A-\u207C\u208A-\u208C\u20A0-\u20BE\u2100\u2101\u2103-\u2106\u2108\u2109\u2114\u2116-\u2118\u211E-\u2123\u2125\u2127\u2129\u212E\u213A\u213B\u2140-\u2144\u214A-\u214D\u214F\u218A\u218B\u2190-\u2307\u230C-\u2328\u232B-\u23FE\u2400-\u2426\u2440-\u244A\u249C-\u24E9\u2500-\u2767\u2794-\u27C4\u27C7-\u27E5\u27F0-\u2982\u2999-\u29D7\u29DC-\u29FB\u29FE-\u2B73\u2B76-\u2B95\u2B98-\u2BB9\u2BBD-\u2BC8\u2BCA-\u2BD1\u2BEC-\u2BEF\u2CE5-\u2CEA\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3004\u3012\u3013\u3020\u3036\u3037\u303E\u303F\u309B\u309C\u3190\u3191\u3196-\u319F\u31C0-\u31E3\u3200-\u321E\u322A-\u3247\u3250\u3260-\u327F\u328A-\u32B0\u32C0-\u32FE\u3300-\u33FF\u4DC0-\u4DFF\uA490-\uA4C6\uA700-\uA716\uA720\uA721\uA789\uA78A\uA828-\uA82B\uA836-\uA839\uAA77-\uAA79\uAB5B\uFB29\uFBB2-\uFBC1\uFDFC\uFDFD\uFE62\uFE64-\uFE66\uFE69\uFF04\uFF0B\uFF1C-\uFF1E\uFF3E\uFF40\uFF5C\uFF5E\uFFE0-\uFFE6\uFFE8-\uFFEE\uFFFC\uFFFD";var e="!-#%-\\*,-/:;\\?@\\[-\\]_\\{\\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E44\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65";var i="A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC";var f="0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19";var h=new RegExp("^(((?![':\"<>])["+g+b+e+i+f+"])+|\\#(\\w)+)$");var d=new RegExp("^(?:\\s*(?:([a-zA-Z]*):\\/\\/|mailto:|skype:|callto:|facetime:|git:|irc:|irc6:|news:|nntp:|feed:|cvs:|svn:|mvn:|ssh:|itms:|notes:|smb:|sourcetree:|urn:|tel:|xmpp:|telnet:|vnc:|rdp:|whatsapp:|slack:|sip:|sips:|magnet:)["+i+f+"\\/]+(?:(?!['\"<>])["+g+b+e+i+f+"])*(?:\\s)*)$");function c(j,k){var l=j.lastIndexOf(k);return l!==-1&&l===j.length-k.length}return function a(j){if(j===null){return false}var m=h.test(j);var n=j.match(d);var l=n&&n.length&&n[1];var k=n&&n.length&&(!l||(!c(l,"script")&&!c(l,"data")));return m||k}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/template/synchrony-presence.soy' */
// This file was automatically generated from synchrony-presence.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.SynchronyPresence.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.SynchronyPresence == 'undefined') { Confluence.Templates.SynchronyPresence = {}; }


Confluence.Templates.SynchronyPresence.container = function(opt_data, opt_ignored) {
  return '<ul id="avatar-list" class="synchrony-doc-' + soy.$$escapeHtml(opt_data.docId) + ' collaborative-avatars-list"></ul><aui-inline-dialog id="more-avatars" alignment="bottom right" responds-to="toggle" aria-hidden="true"><h3>' + soy.$$escapeHtml('Also edited') + '</h3><ul id="more-avatars-list" class="collaborative-avatars-list"></ul></aui-inline-dialog>';
};
if (goog.DEBUG) {
  Confluence.Templates.SynchronyPresence.container.soyTemplateName = 'Confluence.Templates.SynchronyPresence.container';
}


Confluence.Templates.SynchronyPresence.avatar = function(opt_data, opt_ignored) {
  return '<li class="avatar-item' + ((opt_data.active) ? ' p' + soy.$$escapeHtml(opt_data.telepointer) + ' active' : '') + ((opt_data.currentUser) ? ' no-animate-entry' : '') + '"><span title="' + soy.$$escapeHtml(opt_data.title) + '" avatar="' + soy.$$escapeHtml(opt_data.initial) + '"' + ((opt_data.active) ? ' data-origin="' + soy.$$escapeHtml(opt_data.origin) + '"' : '') + ' class="avatar' + ((opt_data.active) ? ' active' : '') + '"' + ((opt_data.username) ? ' data-username="' + soy.$$escapeHtml(opt_data.username) + '"' : '') + '><img src="' + soy.$$escapeHtml(opt_data.avatarUrl) + '"></span></li>';
};
if (goog.DEBUG) {
  Confluence.Templates.SynchronyPresence.avatar.soyTemplateName = 'Confluence.Templates.SynchronyPresence.avatar';
}


Confluence.Templates.SynchronyPresence.overlay = function(opt_data, opt_ignored) {
  return '<span id="synchrony-presence-overlay" class="overlay avatar"><a href="#" aria-controls="more-avatars" class="aui-button" data-aui-trigger></a></span>';
};
if (goog.DEBUG) {
  Confluence.Templates.SynchronyPresence.overlay.soyTemplateName = 'Confluence.Templates.SynchronyPresence.overlay';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/synchrony-presence.js' */
define("confluence-collaborative-editor-plugin/synchrony-presence",["backbone","confluence-collaborative-editor-plugin/avatar-list-view","confluence-collaborative-editor-plugin/overlay-view","ajs","confluence/legacy","confluence/meta","confluence/templates","jquery","underscore"],function(b,c,x,l,n,r,g,f,v){var h=new b.Collection();h.add(s({origin:"current-user",fullname:r.get("current-user-fullname"),name:r.get("remote-user"),avatarURL:r.get("current-user-avatar-url"),active:true,currentUser:true}));var i=false;var q="";var d;var w=[];var e=null;var j;var m=false;if(l.Rte.getEditor()&&l.Rte.getEditor().initialized){k()}else{l.bind("rte-collab-ready",k)}function k(){e=f(g.SynchronyPresence.container({docId:n.getContentId()}));f("#rte-toolbar").append(e);new c({el:"#avatar-list",collection:h});j=new x({collection:h});f("#rte-toolbar").append(j.render())}function a(y){d=y}function s(z){var y=f.extend({},z);y.id=z.origin;y.fullname=z.fullname||"Anonymous";y.name=z.name||"anonymous";y.username=z.name;y.avatarURL=l.contextPath()+z.avatarURL;y.active=z.active||true;y.currentUser=z.currentUser||q===z.origin;return y}function o(y,z,A){q=y;if(!i){d=d||require("tinymce");i=true;w=A;z.on("presence",function(B){j.hideInlineDialog();B.joined.filter(function(C){return C.origin!==q}).forEach(function(C){var D=s(C);p(D);h.add(D,{at:u()})});B.left.forEach(function(C){C.id=C.origin;h.remove(C);t()});t();if(!m){l.bind("editor-heartbeat",function(D,C){if(v.isArray(C.contributors)){w=C.contributors;t()}});m=true}l.trigger("analyticsEvent",{name:"confluence.synchrony.user.in.session",data:{numOtherUsers:h.length,draftId:r.get("draft-id"),contentId:r.get("content-id")}})});d.EditorManager.activeEditor.onClick.add(v.bind(x.prototype.hideInlineDialog,j))}return e}function u(){return h.filter(function(y){return y.get("active")}).length}function p(y){var z=h.findWhere({active:false,id:y.name});if(z){h.remove(z)}}function t(){var y=[];h.each(function(z){if(!(z.get("active")||v.some(w,function(A){return z.get("id")===A.name}))){y.push(z)}});v.each(y,function(z){h.remove(z)});v.each(w,function(z){if(!(z.name===r.get("remote-user")||h.any(function(A){return A.get("id")===z.name||A.get("name")===z.name}))){z.active=false;z.id=z.name;h.add(z)}})}return{appendTo:o,setTinyMce:a}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/avatar-list-view.js' */
define("confluence-collaborative-editor-plugin/avatar-list-view",["backbone","confluence-collaborative-editor-plugin/avatar-view","ajs","jquery","underscore"],function(f,c,a,e,b){var d=5;return f.View.extend({initialize:function(){this.collection.on("add",this.addAvatar,this);this.collection.on("remove",this.removeAvatar,this);this.collection.each(this.addAvatar,this)},addAvatar:function(h){var k=new c({model:h});var g;if(h.get("active")){a.log(h.get("fullname")+" joined. ("+h.get("origin")+")");var j=this.$el.find("li.active").last();if(j.length){g=k.render().insertAfter(j)}else{g=k.render().prependTo(this.$el)}}else{g=k.render().appendTo(this.$el)}var i=function(l){l.addClass("show");l.children(".avatar").tooltip({fade:true,gravity:"ne"})};if(this.collection.length===d+1){i(g)}else{b.defer(i,g)}this._manageOverlayClass()},removeAvatar:function(g){if(g.get("active")){a.log(g.get("fullname")+" left. ("+g.get("origin")+")")}this._manageOverlayClass()},_manageOverlayClass:function(){var g=this.collection.length;this.collection.each(function(i,h){i.set("hidden",g>d&&h>=d-1)});if(g>d){this.$el.addClass("has-overlay")}else{this.$el.removeClass("has-overlay")}}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/avatar-view.js' */
define("confluence-collaborative-editor-plugin/avatar-view",["backbone","ajs","confluence/templates","jquery"],function(d,a,b,c){return d.View.extend({initialize:function(){this.model.on("remove",this.remove,this)},render:function(){this.$el=c(b.SynchronyPresence.avatar({title:this._determineTitle(),initial:this.model.get("fullname").charAt(0).toUpperCase(),fullname:this.model.get("fullname"),username:this.model.get("username"),avatarUrl:this.model.get("avatarURL"),origin:this.model.get("origin"),active:this.model.get("active"),currentUser:this.model.get("currentUser"),telepointer:this._synchronyTelepointerId()}));return this.$el},remove:function(){this.$el.removeClass().addClass("avatar-item animate");if(!this.model.get("hidden")){this.$el.addClass("removing")}this.$el.one(this._getSupportedTransition(),function(){c(this).removeClass("animate removing");c(this).remove()})},_determineTitle:function(){if(this.model.get("currentUser")){var e=["It\u0027s you, but smaller!","Look at you, getting stuff done!"];return e[Math.floor(Math.random()*e.length)]}return this.model.get("fullname")+" "+(this.model.get("active")?"is editing this page.":"has made changes that haven\u0027t been published.")},_getSupportedTransition:function(){var g={transition:"transitionend",MozTransition:"transitionend",OTransition:"oTransitionEnd",MsTransition:"msTransitionEnd",WebkitTransition:"webkitTransitionEnd"};var e=document.createElement("_");for(var f in g){if(e.style[f]!==undefined){return g[f]}}},_synchronyTelepointerId:function(){var g=""+(this.model.get("sub")||this.model.get("origin")||"");var f=0;for(var e=0;e<g.length;e++){f=((f<<5)-f)+g.charCodeAt(e);f=f&f}return(Math.abs(f)%10)}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/overlay-view.js' */
define("confluence-collaborative-editor-plugin/overlay-view",["backbone","aui/inline-dialog2","confluence-collaborative-editor-plugin/avatar-view","confluence/templates","ajs","jquery","underscore"],function(g,d,c,e,a,f,b){return g.View.extend({initialize:function(){this.collection.on("add remove",this.reconcile,this);this.inlineDialog2=document.querySelector("#more-avatars")},render:function(){this.$el=f(e.SynchronyPresence.overlay());this.$el.children("a").tooltip({fade:true,gravity:"ne"});this.$el.on("click",function(){f(".tipsy").remove()});return this.$el},reconcile:function(){var h=this.collection.where({hidden:true});if(h.length>0){this.$el.addClass("show");this.$el.children(".aui-button").html("+"+h.length).attr("title",h.length+" "+"other users are editing.");f("#more-avatars-list").children().remove();h.forEach(function(i){var j=new c({model:i});f("#more-avatars-list").append(j.render())})}else{this.$el.removeClass("show");this.hideInlineDialog()}},hideInlineDialog:function(){if(this.inlineDialog2&&this.inlineDialog2.isVisible&&this.inlineDialog2.isVisible()){this.inlineDialog2.open=false}}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/template/status-indicator.soy' */
// This file was automatically generated from status-indicator.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.CollaborativeEditor.StatusIndicator.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.CollaborativeEditor == 'undefined') { Confluence.Templates.CollaborativeEditor = {}; }
if (typeof Confluence.Templates.CollaborativeEditor.StatusIndicator == 'undefined') { Confluence.Templates.CollaborativeEditor.StatusIndicator = {}; }


Confluence.Templates.CollaborativeEditor.StatusIndicator.container = function(opt_data, opt_ignored) {
  return '<div class="synchrony-status-indicator"><div class="status-indicator-icon aui-icon aui-icon-small' + ((opt_data.error) ? ' aui-iconfont-warning' : (opt_data.saving) ? ' aui-iconfont-devtools-task-in-progress' : ' aui-iconfont-approve') + '" data-tooltip="' + soy.$$escapeHtml(opt_data.tooltipMessage) + '"></div><div class="status-indicator-message" data-tooltip="' + soy.$$escapeHtml(opt_data.tooltipMessage) + '">' + soy.$$escapeHtml(opt_data.statusMessage) + '</div></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.CollaborativeEditor.StatusIndicator.container.soyTemplateName = 'Confluence.Templates.CollaborativeEditor.StatusIndicator.container';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/status-indicator-view.js' */
define("confluence-collaborative-editor-plugin/status-indicator-view",["confluence/templates","backbone","ajs","jquery","underscore"],function(c,e,a,d,b){return e.View.extend({initialize:function(){this.$el.addClass("synchrony");this.listenTo(this.model,"change:saving change:error",this.render);this.model.set("confluenceUnreachable",false);this.model.set("synchronyUnreachable",false);this.model.set("tokenExpired",false);a.bind("rte.heartbeat",b.bind(this.onConfluenceConnectedState,this));a.bind("rte.safe-save.error",b.bind(this._errorPublishing,this));a.bind("rte.preview.error",b.bind(this._errorPublishing,this));this.model.set("connecting",true);this._setProgressState()},render:function(){d(".tipsy").remove();this.$el.html(c.CollaborativeEditor.StatusIndicator.container(this.model.attributes))},onConnectedState:function(g){this.model.set("synchronyUnreachable",false);if(!this.model.has("synchronyEntity")){this.model.set("synchronyEntity",g);var f=this;this.model.get("synchronyEntity").on("update",function(h){f._handleSynchronyUpdateEvent(h,f)});this.model.get("synchronyEntity").on("ack",function(h){f._handleSynchronyAckEvent(h,f)})}this._setSavedState()},onDisconnectedState:function(){this.model.set("synchronyUnreachable",true);this.model.set("connecting",true);this._setErrorState()},onConfluenceConnectedState:function(){if(this.model.get("confluenceUnreachable")){this.model.set("confluenceUnreachable",false);this._setSavedState()}},onConfluenceDisconnectedState:function(){this.model.set("confluenceUnreachable",true);this.model.set("connecting",true);this._setErrorState()},onTokenRenewedState:function(){if(this.model.get("tokenExpired")){this.model.set("tokenExpired",false);this._setSavedState()}},onTokenExpiredState:function(){this.model.set("tokenExpired",true);this.model.set("connecting",true);this._setErrorState()},_handleSynchronyUpdateEvent:function(g,f){if(g.updateType==="local"){f.model.set("pendingChanges",true);f._saving()}},_handleSynchronyAckEvent:function(h,g){var f=h.pending.length>0;g.model.set("pendingChanges",f);if(!f){g.model.set("lastSavedTime",new Date().getTime())}},_saving:function(){var f=this;var g=function(){setTimeout(function(){if(f.model.get("pendingChanges")||new Date().getTime()-f.model.get("lastSavedTime")<f.model.get("minActiveTime")){g()}else{f._setSavedState()}},f.model.get("minActiveTime"))};if(this.model.get("saving")){return}this.model.set("connecting",false);this._setProgressState();g()},_reachable:function(){return !this.model.get("confluenceUnreachable")&&!this.model.get("synchronyUnreachable")&&!this.model.get("tokenExpired")},_errorPublishing:function(g,f){switch(f.status){case 0:this.onConfluenceDisconnectedState();break;case 500:case 503:this.onConfluenceDisconnectedState();break;case 400:case 403:case 404:case 409:case 410:case 413:default:break}},_setSavedState:function(){if(this._reachable()&&a.Meta.get("access-mode")!=="READ_ONLY"){this.model.set("statusMessage",this.model.get("connecting")?"Ready to go":"Changes saved");this.model.set("isReadyToGo",!!this.model.get("connecting"));this.model.set("tooltipMessage","We\u0027re automatically saving all of your changes in a draft.");this.model.set("connecting",false);this.model.set("saving",false);this.model.set("error",false)}else{this._setErrorState()}},_setErrorState:function(){var f=a.Meta.get("access-mode")!=="READ_ONLY";this.model.set("statusMessage","Can\u0027t save changes");this.model.set("tooltipMessage",f?"Can\u0027t reach the server. Check your internet connection, and we\u0027ll keep trying to reconnect you.":"This site is read-only. You can\u0027t make changes right now.");this.model.set("saving",false);this.model.set("error",true)},_setProgressState:function(){if(this._reachable()){this.model.set("statusMessage",this.model.get("connecting")?"Connecting...":"Saving changes");this.model.set("tooltipMessage","We\u0027re automatically saving all of your changes in a draft.");this.model.set("saving",true);this.model.set("error",false)}else{this._setErrorState()}}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/initialise-metrics.js' */
define("collaborative-editing-initialise-metrics-collection",["confluence/legacy"],function(b){var a=function(){var c="confluence.editor.quickedit.loading.times";var d={"confluence.editor":true,"confluence.editor.preload":true,"confluence.editor.quick.fetchContent":true,"confluence.editor.tinymce":true,"confluence.editor.synchrony":true,"confluence.editor.synchrony.CR":true,"confluence.editor.synchrony.connect":true,"confluence.editor.synchrony.deps":true,"confluence.editor.synchrony.init":true,"confluence.editor.synchrony.jsLoad":true,"confluence.editor.synchrony.snapshot":true,"confluence.editor.synchrony.unmarshal":true};var e={"confluence.editor.synchrony.connect":true,};if(b.registerPerformanceSession){b.registerPerformanceSession(c,d,e)}};return a});require("confluence/module-exporter").safeRequire("collaborative-editing-initialise-metrics-collection",function(a){a()});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/lib/SyncManager.js' */
define("confluence-collaborative-editor-plugin/lib/SyncManager",["ajs","jquery"],function(f,d){var b="synchrony.";var h=["id"];var a={START_SYNCHRONIZING_EVENT_NAME:"start",STOP_SYNCHRONIZING_EVENT_NAME:"stop",MAX_CONSECUTIVE_AUTO_RECOVERY_TRIGGERED:10,MAX_WAIT_TIME_TO_RESTART:30000,DEBUG_MODE:false};var g={AUTO_RECOVERY_TIMER_TRIGGERED:"Auto recovery has been triggered",AUTO_RECOVERY_TIMER_TRIGGERED_TOO_MANY_TIMES:"Auto recovery has been triggered too many times for the same action",INVALID_EVENT_PAYLOAD:"Invalid payload, missing required params",START_ENTITY:"Starting entity synchronization",STOP_ENTITY:"Stoping entity synchronization"};var c=function(){return{DISABLED_SYNC_STATUS:false,RECOVERY_TIMER_RUNNING:false,CONSECUTIVE_AUTO_RECOVERY_TRIGGERED:0}};var i=function(j){return h.every(function(k){return typeof j[k]!=="undefined"})};var e=function(k,l){this.entity=k;this.settings=d.extend({},a,l||{});this.controlSyncState={};this.recoveryTimeoutTasks={};var j=function(m,o,n){if(!i(n)){this.displayLogMessage(g.INVALID_EVENT_PAYLOAD,o,n)}else{m(n)}};f.bind(b+this.settings.START_SYNCHRONIZING_EVENT_NAME,j.bind(this,this.enableSynchronization.bind(this)));f.bind(b+this.settings.STOP_SYNCHRONIZING_EVENT_NAME,j.bind(this,this.disableSynchronization.bind(this)))};e.prototype.getOrCreateControlSyncState=function(k){var j=this.controlSyncState[k]=this.controlSyncState[k]||c();return j};e.prototype.enableDebug=function(j){this.settings.DEBUG_MODE=typeof j!=="undefined"?j:true};e.prototype.displayLogMessage=function(){if(this.settings.DEBUG_MODE){var j=Array.prototype.slice.call(arguments);j.splice(0,0,"DEBUG: "+new Date().toLocaleTimeString());console.log.apply(console,j)}};e.prototype.disableSynchronization=function(k){var l=k.id;var j=this.getOrCreateControlSyncState(l);j.DISABLED_SYNC_STATUS=true;this.clearAutoRecoveryTimer(l);this.setAutoRecoveryTimer(k);this.entity.stop(l);this.displayLogMessage(g.STOP_ENTITY,l,d.extend(true,{},this.controlSyncState))};e.prototype.enableSynchronization=function(k){var l=k.id;var j=this.getOrCreateControlSyncState(l);j.DISABLED_SYNC_STATUS=false;this.clearAutoRecoveryTimer(l);this.entity.start(l);this.displayLogMessage(g.START_ENTITY,l,d.extend(true,{},this.controlSyncState))};e.prototype.clearAutoRecoveryTimer=function(k){var j=this.getOrCreateControlSyncState(k);clearTimeout(this.recoveryTimeoutTasks[k]);delete this.recoveryTimeoutTasks[k];j.RECOVERY_TIMER_RUNNING=false};e.prototype.setAutoRecoveryTimer=function(k){var l=k.id;var j=this.getOrCreateControlSyncState(l);j.RECOVERY_TIMER_RUNNING=true;this.recoveryTimeoutTasks[l]=setTimeout(function(){this.displayLogMessage(g.AUTO_RECOVERY_TIMER_TRIGGERED,l);this.clearAutoRecoveryTimer(l);j.DISABLED_SYNC_STATUS=false;j.RECOVERY_TIMER_RUNNING=false;j.CONSECUTIVE_AUTO_RECOVERY_TRIGGERED++;f.trigger("analyticsEvent",{name:"confluence.synchrony.syncmanager.failed-to-restart",data:{id:l}});if(j.CONSECUTIVE_AUTO_RECOVERY_TRIGGERED>=this.settings.MAX_CONSECUTIVE_AUTO_RECOVERY_TRIGGERED){this.displayLogMessage(g.AUTO_RECOVERY_TIMER_TRIGGERED_TOO_MANY_TIMES,l,this.controlSyncState[l].CONSECUTIVE_AUTO_RECOVERY_TRIGGERED);f.trigger("analyticsEvent",{name:"confluence.synchrony.syncmanager.consecutive-failed-to-restart",data:{id:l}})}this.entity.start(l)}.bind(this),k.maxWaitTimeToRestart||this.settings.MAX_WAIT_TIME_TO_RESTART)};return e});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/telepointer-cleaner.js' */
define("confluence-collaborative-editor-plugin/telepointer-cleaner",["confluence-editor-reliable-save/reliable-save","jquery"],function(a,b){var c=function(d){var e=b("<div>");e.append(d);e.find(".synchrony-container, .synchrony-tp").remove();return e.html()};a.registerCleanupFunction(c)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/editor-blanket.js' */
define("confluence-collaborative-editor-plugin/editor-blanket",["ajs","jquery","confluence/meta","confluence-editor/support/atlassian-editor-support"],function(h,e,b,c){var f={};function a(k){switch(k){case"block":f.cssClass4Form="editor-block";f.ariaType4Form="aria-disabled";f.cssClass4EditorToolbar="";break;default:f.cssClass4Form="editor-loading editor-loading-spinner";f.ariaType4Form="aria-busy";f.cssClass4EditorToolbar="editor-loading";break}var j=e("#editpageform, #createpageform");j.addClass(f.cssClass4Form);j.attr(f.ariaType4Form,true);e("#content-title").attr("tabindex",-1);e("#wysiwygTextarea_ifr").attr("tabindex",-1);e(".aui-toolbar2-primary").addClass(f.cssClass4EditorToolbar)}function i(){var j=e("#editpageform, #createpageform");j.removeClass(f.cssClass4Form);j.attr(f.ariaType4Form,false);e("#rte").css("opacity",1).addClass("editor-blanket-ease-in");e("#content-title").attr("tabindex",1);e("#wysiwygTextarea_ifr").attr("tabindex",100);e("#content-title-div").css("opacity",1).addClass("editor-blanket-ease-in");e(".aui-toolbar2-primary").removeClass(f.cssClass4EditorToolbar);f={}}function g(){e("#rte").css("opacity",1);e("#content-title-div").css("opacity",1)}function d(j){if(c.isCollaborativeContentType()&&j.state()==="pending"){a();j.done(i)}else{g()}}return{applyBlanket:d,showEditor:g,showBlanket:a}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/synchrony-auth.js' */
define("confluence-collaborative-editor-plugin/synchrony-auth",["jquery","ajs","confluence/meta","confluence/legacy","confluence-collaborative-editor-plugin/synchrony-util"],function(f,i,d,k,j){var a,c=0;function l(){return j.retrieveMetadata("synchrony-token")}function e(){return parseInt(j.retrieveMetadata("synchrony-expiry"))}function g(){var p=e();if(isNaN(p)){return false}return p>(Date.now()/1000)}function o(p){if(p[1]==="error"&&p[0].responseText){return JSON.parse(p[0].responseText)}else{return p[0]}}function n(p){return h().pipe(p).pipe(function(q){var s=o(q);if(q[1]==="error"&&s.type&&s.type.match(/^jwt\//)){var r={errorType:s.type,message:s.message};return h(r).pipe(p)}return q})}function b(p,q){j.time("confluence.editor.synchrony.token");var r=q&&q.errorType?"?errorType="+q.errorType:"";f.ajax({dataType:"json",method:"GET",url:encodeURI(i.contextPath()+"/rest/synchrony/1.0/token/"+k.getContentId()+"/generate"+r)}).done(function(s){d.set("synchrony-token",s.synchronyToken);d.set("synchrony-expiry",s.synchronyExpiry);c=0;p.resolve(s.synchronyToken);if(a){a.onConfluenceConnectedState();a.onTokenRenewedState()}i.trigger("dismiss.editor.error.message",{messageKey:"synchrony-token-expired",enablePublish:true});i.debug("Synchrony JWT token updated.");j.timeEnd("confluence.editor.synchrony.token")}).fail(function(){c++;if(c>=10){i.trigger("editor.error.message",{messageKey:"synchrony-token-expired",message:"We couldn\u0027t process your request, as it was missing a required security token. Copy your work, then re-submit the form or reload the page.",disablePublish:true})}if(a){a.onConfluenceDisconnectedState();a.onTokenExpiredState()}i.log(q?q.message:"Confluence failed to renew JWT token.");p.reject("token")})}function h(q){var p=f.Deferred();if(!q&&g()){p.resolve(l())}else{i.log("["+new Date()+"] Synchrony JWT expired or invalid, retrieving new token.");b(p,q)}return p.promise()}function m(p){a=p}return{init:m,performRequest:n,getTokenPromise:h}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/unsupported-extension.js' */
define("confluence-collaborative-editor-plugin/unsupported-extension",["ajs","jquery","confluence/legacy","confluence-editor/editor/page-editor-message","window","confluence-collaborative-editor-plugin/editor-blanket"],function(d,g,h,e,f,c){function b(){var i=d.Rte.getEditor().getBody();if(i.hasAttribute("data-gramm")&&i.hasAttribute("data-gramm_id")){d.trigger("synchrony.stop",{id:"confluence.editor.block.by.grammarly",maxWaitTimeToRestart:1000*60*60*24*365});d.trigger("analyticsEvent",{name:"confluence.synchrony.editor.grammarly.block"});i.setAttribute("contentEditable",false);g(i).find(".contentLayout2 .innerCell").each(function(){this.setAttribute("contentEditable",false)});c.showBlanket("block");h.Editor.UI.setButtonsState(false,h.Editor.UI.buttons);e.handleMessage("collaborative-editor-unsupported-extension",{type:"error",title:"Grammarly isn\u0027t supported",message:d.format("The Grammarly extension doesn\u0027\u0027t play well with collaborative editing. Disable it and \u003ca {0}\u003ereload the page\u003c/a\u003e to keep working.",'href="#" id="collabGrammarlyReload"')});g("#collabGrammarlyReload").click(function(){d.trigger("analyticsEvent",{name:"confluence.synchrony.editor.grammarly.reload.click"});f.location.reload();return false});d.trigger("synchrony-unsupported-extension")}}function a(){b()}return{check:a}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/synchrony-entity.js' */
define("confluence-collaborative-editor-plugin/synchrony-entity",["jquery","ajs","confluence-collaborative-editor-plugin/synchrony-auth","confluence-collaborative-editor-plugin/synchrony-util","confluence-collaborative-editor-plugin/unsupported-extension","confluence-collaborative-editor-plugin/util/is-valid-uri"],function(c,h,e,i,g,b){function d(k){return function(l){return null===l||k.test(l)}}function j(m){var k=d(/^[\w\.\-\+\%]+$/i);var l=d(/^[\w-]+$/);return c.extend({},m.whitelists.tinymce,{styles:c.extend({},m.whitelists.tinymce.styles,{"padding-top":false,"padding-right":false,"padding-bottom":false,"padding-left":false,padding:false,display:k,"list-style-type":k}),attributes:c.extend({},m.whitelists.tinymce.attributes,{"confluence-query-params":true,"data-element-title":true,"data-ref":true,accesskey:true,datetime:true,"data-anchor":true,"data-encoded-xml":true,"data-highlight-class":true,"data-highlight-colour":true,"data-space-key":true,"data-username":true,"data-emoticon-name":l,"data-hipchat-emoticon":l,"data-entity-id":true,"data-entity-type":true,"data-favourites-bound":true,"data-macro-id":true,"data-macro-name":true,"data-macro-schema-version":true,"data-macro-body-type":true,"data-macro-parameters":true,"data-macro-default-parameter":true,"data-atlassian-layout":true,"data-placeholder-type":true,"data-layout":true,"data-title":true,"data-type":true,"data-inline-task-id":true,"data-inline-tasks-content-id":true,"data-base-url":true,"data-linked-resource-id":true,"data-linked-resource-type":true,"data-linked-resource-version":true,"data-linked-resource-default-alias":true,"data-linked-resource-container-version":true,"data-linked-resource-content-type":true,"data-unresolved-comment-count":true,"data-location":true,"data-image-height":true,"data-image-width":true,"data-attachment-copy":true,"data-content-title":true,"data-filename":true,href:b}),classes:function(n){switch(n){case"mceSelected":case"active-resizable":return false;break;default:return true}},elements:c.extend({},m.whitelists.tinymce.elements,{time:true,mark:true,label:true,form:true})})}function a(k,m,n){var l=j(k);return{profile:"tinymce",selectionCorrections:false,telepointer:{refreshOnResize:true,label:{hover:true,movement:1000,text:function(q){try{var o=q.fullname||"Anonymous";return o.charAt(0).toUpperCase()}catch(p){h.log(p)}return"&#9786;"}}},tinymce:{monkeyPatchUndoManager:true,instance:m},whitelist:function(r){var o=r.domNode===n;var q=r.type==="node";var p=r.type==="attribute"&&r.name==="data-title";if(o){return q||p}return k.isWhitelisted(l,r)},domReadHook:function(){h.trigger("cursor-target-refresh");g.check()}}}function f(k,l,o,n,m){return k.entity({url:i.getServiceUrl(),entityId:i.getEntityId(),jwt:e.getTokenPromise,initRev:m.confRev,history:n,presence:true,useFallback:i.getXhrFallbackFlag()}).bind(o,a(k,l,o))}return{bind:f,makeWhitelist:j}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/util/url-parser.js' */
define("confluence-collaborative-editor-plugin/util/url-parser",["window"],function(a){return{parseUrl:function(c){var b=a.document.createElement("a");b.href=c;return{protocol:b.protocol.replace(":",""),hostname:b.hostname,port:b.port,pathname:b.pathname==="/"?"":b.pathname,search:b.search,hash:b.hash.substr(b.hash.indexOf("#")+1,b.hash.length),host:b.host}}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/util/location-provider.js' */
define("confluence-collaborative-editor-plugin/util/location-provider",["window"],function(a){return{getLocation:function(){return a.location}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/util/editor-format-fixer.js' */
define("confluence-collaborative-editor-plugin/util/editor-format-fixer",["underscore","confluence/meta","confluence-collaborative-editor-plugin/util/url-parser"],function(d,e,f){var c=function(h){var k=0;var q="img[data-base-url]";var n=e.get("base-url");var t=f.parseUrl(n);var l=h.querySelectorAll(q);for(var m=0;m<l.length;m++){var j=l[m];var p=f.parseUrl(j.attributes["data-base-url"].value);if(!d.isEqual(p,t)){var s=j.attributes["data-image-src"].value;var o=j.attributes.src.value;var r=s.replace(p.pathname,t.pathname);var u=o.replace(p.pathname,t.pathname);j.setAttribute("data-base-url",n);j.setAttribute("data-image-src",r);j.setAttribute("src",u);k++}}return k};var g=function(j){var l=0;var s=["a[data-base-url][href][data-linked-resource-type='page']","a[data-base-url][href][data-linked-resource-type='blogpost']","a[data-base-url][href][data-linked-resource-type='comment']","a[data-base-url][href][data-linked-resource-type='space']","a[data-base-url][href][data-linked-resource-type='attachment']","a[data-base-url][href][data-linked-resource-type='custom']"].join(",");var r=e.get("base-url");var q=f.parseUrl(r);var m=j.querySelectorAll(s);for(var n=0;n<m.length;n++){var k=m[n];var p=f.parseUrl(k.attributes["data-base-url"].value);if(!d.isEqual(p,q)){var h=f.parseUrl(k.attributes.href.value);var o=r+h.pathname.replace(p.pathname,"")+h.search+(h.hash?"#"+h.hash:"");k.setAttribute("data-base-url",r);k.setAttribute("href",o);l++}}return l};var b=function(h){var m=0;var r="img[data-macro-name='view-file']";var u=f.parseUrl(e.get("base-url"));var n=h.querySelectorAll(r);for(var q=0;q<n.length;q++){var k=n[q];var t=k.attributes.src.value;var l=["/rest/documentConversion/latest/","/plugins/servlet/confluence/placeholder/unknown-attachment?"];for(var p=0;p<l.length;p++){var s=l[p];var o=t.indexOf(s);if(o!=-1){var w=t.substr(0,o);if(w!==u.pathname){var v=u.pathname+t.substr(o);k.setAttribute("src",v);m++}}}}return m};var a=function(j){var i="a[data-linked-resource-id][data-linked-resource-type='userinfo'][userkey]";var h=j.querySelectorAll(i);Array.prototype.forEach.call(h,function(k){k.removeAttribute("data-linked-resource-id")});return h.length};return{fixStaleBaseUrl:function(j){var h=c(j);var k=b(j);var i=g(j);return h+k+i},fixMentions:function(h){return a(h)}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/synchrony-handlers.js' */
define("confluence-collaborative-editor-plugin/synchrony-handlers",["underscore","jquery","ajs","confluence/meta","confluence/analytics-support","confluence/legacy","confluence-editor/editor/page-editor-message","confluence-collaborative-editor-plugin/lib/SyncManager","confluence-collaborative-editor-plugin/synchrony-util","confluence-collaborative-editor-plugin/synchrony-content","confluence-collaborative-editor-plugin/synchrony-presence","confluence-collaborative-editor-plugin/util/location-provider","confluence-collaborative-editor-plugin/util/url-parser","confluence-collaborative-editor-plugin/util/editor-format-fixer"],function(J,y,u,b,e,f,g,D,c,h,G,j,v,i){var q;var t;var a;var w;var o;var C;var E;var p=[];function r(N,O,M,L){c.time("confluence.editor.synchrony.connect");o=N;a=O;t=M;E=L.pipe(null,function(P){o.destroy();t.onDisconnectedState();return K(P,"collaborative-editor-load-failure",true)});q=y("#syncRev");w=a.getBody();o.on("init",x).on("update",z).on("ack",A).on("connected",m).on("disconnected",k).on("error",H);C=new D(o,{DEBUG_MODE:true});h.bindPostPasteFix();h.readTitleFromRootElement(w);f.Editor.overrideBeforeSave(n);y("#content-title").keyup(h.writeTitleToRootElement)}function F(M,L){if(L.contributors){p=L.contributors;u.unbind(M,F)}}u.bind("editor-heartbeat",F);function x(L){q.val(L.rev.toString())}function A(L){q.val(L.rev.toString());u.trigger("synchrony.entity.ack",{pendingChanges:L.pending.length>0})}function k(){t.onDisconnectedState();u.log("Synchrony disconnected!")}function H(L){if(L.level==="fatal"){u.trigger("editor.error.message",{disablePublish:true})}}function m(L){c.timeEnd("confluence.editor.synchrony.connect");u.log("Synchrony connected.");G.appendTo(L.sid,o,p);t.onConnectedState(o);u.trigger("synchrony.connected");h.fixTinymceCaretContainer(w,a)}function K(M,L,N){return{origin:"synchrony",cause:M,messageKey:L,disablePublish:N}}function n(O){var N=5000;var P=y.Deferred();function M(){P.resolve(O)}function L(R){if(!R.pending.length){o.off("ack",L);q.val(R.rev.toString());M()}}var Q=!o.ackState().pending.length;if(Q){M()}else{o.on("ack",L);setTimeout(function(){o.off("ack",L);P.reject(K("timeout"))},N)}return y.when(P,E).promise()}function I(M){var L=c.getLatestRevisionWithAttr(M.revisions,"user");return L?L.meta.user:"Anonymous"}function s(L){g.handleMessage("editor.synchrony.page-published",{type:"info",message:u.format("{0} published this page.",u.escapeHtml(L)),close:"auto"});u.trigger("analyticsEvent",{name:"confluence.synchrony.external-changes.publish"});u.trigger("editor-shared-drafts-published")}function l(){b.set("new-page",false);b.set("page-id",f.getContentId());b.set("draft-id","0");if(!f.Editor.isLimitedModeEnabled()){f.Editor.UI.setButtonState(true,y("#rte-button-discard"))}}function z(M){if(M.updateType==="remote"){q.val(M.revisions[M.revisions.length-1].rev.toString());if(c.hasRevisionTrigger(M.revisions,"reset")){g.handleMessage("editor.synchrony.revert-page",{type:"info",message:u.format("{0} reverted to a previous version of this page.",u.escapeHtml(I(M)))});b.set("has-collaborated",false);B();u.trigger("analyticsEvent",{name:"confluence.synchrony.external-changes.revert"});u.trigger("editor-shared-drafts-discarded");f.Editor.heartbeat()}if(c.hasRevisionTrigger(M.revisions,"publish")){if(h.isUnpublished()){l()}b.set("has-collaborated",false);B();s(I(M));f.Editor.heartbeat()}if(c.hasRevisionType(M.revisions,"external")){u.trigger("editor.external.change")}var L=c.getLatestRevisionWithAttr(M.revisions,"confVersion");if(L&&L.meta.confVersion){y('meta[name="page-version"]').attr("content",L.meta.confVersion);y('meta[name="ajs-page-version"]').attr("content",L.meta.confVersion);b.set("page-version",L.meta.confVersion)}}setTimeout(function(){if(M.updateType==="init"||M.updateType==="remote"){u.trigger("editor.remote.change");h.readTitleFromRootElement(w)}if(M.updateType=="init"){if(d(j.getLocation())){a.undoManager.ignore(function(){var N=i.fixStaleBaseUrl(w);if(N>0){e.publish("collab.edit.format.stale.fix.count",{staleformatfixed:N})}})}else{u.log("Request url does not match the configured base url. Not performing fixStaleBaseUrl().")}a.undoManager.ignore(function(){i.fixMentions(w)})}h.fixTinymceCaretContainer(w,a);if(M.updateType==="local"){if(!a.undoManager.hasUndo()){a.setDirty(false)}u.trigger("editor.local.change")}},0)}function B(){if(o.ackState().pending.length===0){a.setDirty(false)}}function d(L){var M=b.get("context-path");var O=v.parseUrl(b.get("base-url"));var N=v.parseUrl(L);var P=v.parseUrl(N.protocol+"://"+N.host+M);return J.isEqual(O,P)}return{handle:r}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/synchrony-editor.js' */
define("confluence-collaborative-editor-plugin/synchrony-editor",["window","jquery","ajs","confluence/legacy","confluence-collaborative-editor-plugin/editor-blanket","confluence-collaborative-editor-plugin/synchrony-util","confluence-collaborative-editor-plugin/synchrony-content","confluence-collaborative-editor-plugin/synchrony-auth","confluence-collaborative-editor-plugin/synchrony-entity","confluence-collaborative-editor-plugin/synchrony-handlers","confluence-editor/support/atlassian-editor-support","confluence-editor/loader/collaborative-helper",],function(C,A,t,g,l,d,h,i,y,u,c,z){var E={};d.time("confluence.editor.synchrony.jsLoad");var I=10*60*1000;var s=30*1000;var r;var F=false;var q=false;var k=false;var m;A(C).bind("beforeunload",function(){if(!q){t.trigger("analyticsEvent",{name:"confluence.synchrony.exit.before.connecting",data:{afterTimeout:k,contentId:g.getContentId()}})}});function x(L){A('meta[name="ajs-collaborative-editor-status"]').attr("content",L)}function w(){return !t.Rte.isQuickEdit}function o(){var L=A.Deferred();t.$(function(){t.$("body").addClass("synchrony-active");var M=require("confluence-collaborative-editor-plugin/status-indicator-view");r=new M({el:"#pluggable-status",model:new Backbone.Model({minActiveTime:500})});i.init(r);L.resolve()});return L}function H(L){var N,M;switch(L){case"timeout":N="The editor didn\u0027t load this time";M="The connection timed out. If it happens again, speak to your Confluence admin. You may be using a proxy server that prevents WebSocket connections.\u003c/br\u003e\u003ca href=\u0022#\u0022 id=\u0022websocketRetry\u0022\u003eTry again\u003c/a\u003e&nbsp;.&nbsp;\u003ca href=\u0022https://confluence.atlassian.com/display/CONFKB/Confluence+throws+The+editor+didn%27t+load+this+time+error+when+trying+to+edit+a+page\u0022 target=\u0022_blank\u0022 id=\u0022websocketFindmore\u0022\u003eFind out more\u003c/a\u003e";break;case"synchrony-requests":F=true;N="";M="Something went wrong after loading the editor. Copy your unsaved changes and refresh the page to keep editing.";break;case"limited-mode":F=true;N="";M="Something went wrong while loading the editor, please try again.";break;default:F=true;N="";M="This page is taking longer to load than usual. Give it a few moments, then try refreshing. Still having issues? Contact your Confluence admin.";break}t.trigger("editor.error.message",{title:N,messageKey:"collaborative-editor-load-failure",message:M,disablePublish:true,close:"manual"})}function v(){t.trigger("dismiss.editor.error.message",{messageKey:"collaborative-editor-load-failure",enablePublish:true})}function j(N,L){var M=A.Deferred();N.done(function(){d.timeEnd(L)},M.resolve);N.fail(M.resolve);return M.promise()}function G(L,M){var O=((M[1]==="error"&&M[0].responseText)?JSON.parse(M[0].responseText):"");var N=false;if(O.type==="invalid-ancestor"){N="synchrony"}else{if(O.type==="out-of-order-revision"){N="confluence"}}if(N){t.log("Performing synchrony recovery");A.ajax({url:t.contextPath()+"/rest/synchrony/1.0/content/"+g.getContentId()+"/recovery?behind="+N+"&conflictingRev="+O["conflicting-rev"],type:"PUT"});return"synchrony-requests"}if((M[1]!=="success"&&L[1]!=="success")||(M[1]!=="success"&&O.type!=="duplicate-mismatch")){t.trigger("analyticsEvent",{name:"confluence.synchrony.client.content.reconciliation.failure",data:{type:O.type,contentId:g.getContentId()}});return"synchrony-requests"}return false}E._bindEditor=function(S,O,V,L,N){d.time("confluence.editor.synchrony.init");var U=G(V,L);if(U){return null}var T=A("#syncRev");var R=null;if(V[1]==="success"){var Q=V[0];R={base:{rev:Synchrony.rev(Q.stateAt),state:Q.state}};T.val(R.base.rev.toString())}t.log("Synchrony will load with contentId: ",g.getContentId());try{var M=O.getBody();M.setAttribute("data-title",S.title);m=y.bind(Synchrony,O,M,R,S);u.handle(m,O,r,N);t.trigger("editor.remote.change");O.setDirty(false);d.timeEnd("confluence.editor.synchrony.init");return m}catch(P){t.logError(P);return null}};function K(M){function L(N){d.time("confluence.editor.synchrony.snapshot");return j(A.ajax({type:"POST",url:encodeURI(d.getServiceUrl()+"/data"+d.getEntityId()+"?state-at=@head&state-format=type-tagged&rewrite-request=true&cached="+M),contentType:"text/plain",dataType:"json",data:JSON.stringify({headers:{"content-type":"application/json","x-token":N},method:"GET"})}).pipe(d.asArray,d.asArray),"confluence.editor.synchrony.snapshot")}return i.performRequest(L)}function e(L){function M(N){d.time("confluence.editor.synchrony.CR");return j(A.ajax({type:"POST",url:encodeURI(d.getServiceUrl()+"/data"+d.getEntityId()+"?optimistic=true&rewrite-request=true"),dataType:"json",contentType:"text/plain",data:JSON.stringify({body:{ancestor:L.syncRev,rev:L.confRev,state:{format:"html",value:L.html},merges:{master:{meta:{type:"client-reconciliation"}}}},headers:{"content-type":"application/json","x-token":N},method:"PUT"})}).pipe(d.asArray,d.asArray),"confluence.editor.synchrony.CR")}if(!L.syncRev&&h.isUnpublished()&&(L.raw.length===0||/^\s+$/.test(L.raw))){return A.Deferred().resolve([{},"success"])}else{if(h.isContentEmpty(L.raw)){t.trigger("analyticsEvent",{name:"confluence.synchrony.client.content.reconciliation.blank-content",data:{contentId:g.getContentId()}});return A.Deferred().resolve([{},"success"])}}return i.performRequest(M)}function B(L){d.time("confluence.editor.synchrony");A.when(Date.now(),L).pipe(function(N){x("on");var M=Date.now();t.trigger("analyticsEvent",{name:"confluence.synchrony.editor.loaded",data:{durationMillis:(M-N),contentId:g.getContentId()}});t.trigger("rte-collab-ready");d.timeEnd("confluence.editor.synchrony");d.timeEnd("confluence.editor")})}function n(){var L=J("synchrony.connected synchrony.connected.fake");var M=J("synchrony.connected synchrony.connected.fake synchrony-unsupported-extension",s);M.fail(function(N){H(N);t.trigger("analyticsEvent",{name:"confluence.synchrony.editor.load.timeout",data:{contentId:g.getContentId()}});a();k=true;L.done(function(){if(!F){q=true;v()}})})}E._initialiseCollabEditingComponents=function(L){var M=o();A(C).one("synchrony.connected.fake",function(N){if(N.namespace==="connected.fake"){M.resolve();L.resolve();v();x("fake")}});return M};E._initialiseSynchrony=function(){d.time("confluence.editor.synchrony.deps");(function(M){var N=M.Synchrony=M.Synchrony||{};if(!N.ready){var O=N._cbs=N._cbs||[];N.ready=function(R){O.push(R)}}var Q=function(){1===N.state&&(N.SockJS=M.SockJS,N.init())};if(M.SockJS){N.init&&Q()}else{var P=M._sockjs_onload;M._sockjs_onload=function(){Q();P&&P.apply(this,arguments)}}})(C);var L=A.Deferred();Synchrony.ready(L.resolve);return A.when(L.promise(),d.loadScript(["/js/vendor/sockjs.min.js","/js/synchrony.min.js"])).pipe(function(M){d.timeEnd("confluence.editor.synchrony.deps");t.log("Synchrony successfully initialised.");return M})};function D(U,N,R){var O=E._initialiseSynchrony();var L=J("synchrony.connected.fake");var M=J(null);N.pipe(function(){setTimeout(M.reject,s,"synchrony-requests")});var T=E._initialiseCollabEditingComponents(M);var S=Date.now();var Q=null;var P=null;if(!t.DarkFeatures.isEnabled("synchrony-pessimistic-snapshot")){Q=O.pipe(function(){return K(true)});Q.done(function(W){P=W[1]})}var V=A.when(U,O).pipe(function(){if(!Q||Q.state()==="rejected"||P==="error"||(I<Date.now()-S)){return K(false)}return Q});R.pipe(function(){n();B(L);l.applyBlanket(L)});N.pipe(function(W){var X=O.pipe(function(){return e(W)});V=A.when(V,O).pipe(function(Z,aa){d.time("confluence.editor.synchrony.unmarshal");var Y=Z;if(Z[1]==="success"){Y=[{stateAt:Z[0].stateAt,state:aa.unmarshal(Z[0].state.value)},Z[1]]}d.timeEnd("confluence.editor.synchrony.unmarshal");return Y});A.when(V,X).pipe(function(Y,aa){var Z=G(Y,aa);if(Z){M.reject(Z)}else{M.resolve()}});if(!t.DarkFeatures.isEnabled("synchrony-pessimistic-CR")&&(W.syncRevSource==="synchrony-ack"||h.isUnpublished())){t.debug("confluence.editor.synchrony: content up to date, not waiting for CR");M.fail(H);return A.when(W,R,V,[{},"success"],T)}return A.when(W,R,V,X,T)}).pipe(function(aa,Z,X,Y){var W=E._bindEditor(aa,Z,X,Y,M);if(!W){t.trigger("analyticsEvent",{name:"confluence.synchrony.bind.failure",data:{contentId:g.getContentId()}});return A.Deferred().reject("editor-binding-failed")}L.resolve()}).fail(function(W){R.always(function(){if(W!=="synchrony-not-enabled"){t.log("Failed to load the collaborative editor",W);H(W);t.$(function(){r.onDisconnectedState()});x("failed");t.trigger("analyticsEvent",{name:"confluence.synchrony.error",data:{error:W,contentId:g.getContentId()}})}})})}E.init=function(){if(c.isCollaborativeContentType()){var L=b("rte-quick-edit-init rte-collaborative-content-ready rte-initial-raw-content-ready",true);var N=b("rte-quick-edit-init rte-collaborative-content-ready rte-initial-raw-content-ready rte-collab-editor-loaded",false);var O=b("rte-collaborative-content-ready rte-initial-raw-content-ready",false,h.getContent);var M=b("rte-collab-editor-loaded",false,t.Rte.getEditor);M=b("rte-ready rte-begin-collab-editing",false,t.Rte.getEditor,w,M);L.pipe(function(){D(N.promise(),O.promise(),M.promise())});O.fail(H);t.trigger("synchrony-events-bound");M.fail(function(P){if(P==="synchrony-not-enabled"){f();t.log("Synchrony is not available in this context.")}})}};E.register=function(){z.registerPlugin(E)};E.getSynchronisedEditorContent=function(){var N=m.ackState();if(N.rev){var M=Synchrony.makeDom(N.state,{document:document,whitelist:y.makeWhitelist(Synchrony)});var L=require("tinymce");return{content:L.activeEditor.serializer.serialize(M),syncRev:N.rev.toString()}}t.logError("Synchrony hasn't acked any data, can't fetch draft data");return null};function f(){l.showEditor();x("off")}function J(M,O,L){var P=A.Deferred();if(M){t.bind(M,function N(R,Q){t.debug("confluence.editor.synchrony.event: "+R.type+"."+R.namespace);t.unbind(M,N);P.resolve(Q)})}if(O){setTimeout(P.reject,O,L||"timeout")}return P}function b(O,R,N,L,M){var Q=M||A.Deferred();if(d.isEditorInitialised()||(R&&d.synchronyReady())){return p(Q,N)}t.bind(O,function P(T,S){t.debug("confluence.editor.event "+T.type+"."+T.namespace);Q.always(function(){t.unbind(O,P)});p(Q,N,S,L)});return Q}function p(P,N,O,M){if(!d.synchronyReady()){return P.reject("synchrony-not-enabled")}if(!M||M()){var L=N?N(O):O;return L&&L.error?P.reject(L.error):P.resolve(L)}return P}function a(){A("#websocketRetry").on("click",function(){t.trigger("analyticsEvent",{name:"confluence.synchrony.editor.websocket.retry.click"});C.location.reload();return false});A("#websocketFindmore").on("click",function(){t.trigger("analyticsEvent",{name:"confluence.synchrony.editor.websocket.findmore.click"})})}d.timeEnd("confluence.editor.synchrony.jsLoad");return E});require("confluence/module-exporter").safeRequire("confluence-collaborative-editor-plugin/synchrony-editor",function(a){a.register();a.init()});
}catch(e){WRMCB(e)};