WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.adaptavist.confluence.contentFormattingMacros:macro-analytics-bundle', location = 'frontend/bundles/macro-analytics.bundle.js' */
!function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="http://localhost:8080/target/classes/frontend/bundles",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);var n={reportMacroInserted:function(e){var t=this.buildAnalyticData("Macro-Inserted",e);return this.reportAnalyticsToBackend(t)},reportMacroEdited:function(e){var t=this.buildAnalyticData("Macro-Edited",e);return this.reportAnalyticsToBackend(t)},reportMacrosDeleted:function(e){var t=this,r=(Array.isArray(e)?e:[e]).map(function(e){return t.buildAnalyticData("Macro-Deleted",e)});return this.reportAnalyticsToBackend(r)},buildAnalyticData:function(e,t){return{eventType:[e],spaceKey:[AJS.params.spaceKey],pageId:[AJS.params.pageId],macroName:[t]}},reportAnalyticsToBackend:function(e){var t=Array.isArray(e)?e:[e];return $.ajax({type:"POST",contentType:"application/json",async:!0,url:AJS.params.baseUrl+"/plugins/servlet/cfm/analytics/macro-usage",data:JSON.stringify(t)}).error(function(){})}};var a="com.adaptavist.confluence.contentFormattingMacros",o=function(e,t){for(var r=[],n=i(),a=e(),o=0;o<a.length;o++){var c=t(a[o]),u=n.filter(function(e){return e.macroName===c});1===u.length&&r.push(u[0])}return r};function i(){return AJS.MacroBrowser.metadataList.filter(function(e){return e.pluginKey===a})}var c=function(){return $("#wysiwygTextarea_ifr")[0].contentWindow.getSelection().getRangeAt(0).cloneContents().querySelectorAll("table.wysiwyg-macro, img.editor-inline-macro")},u=function(e){return e.dataset.macroName},d=function(){return $('div.aui-dropdown ol li.active a[class^="autocomplete-macro"]')},l=function(e){var t=$(e).attr("class");return t.substring("autocomplete-macro-".length+t.indexOf("autocomplete-macro-"))},s=function(){return $("div#macro-insert-container input.macro-name")},f=function(){return $("#avst-custom-dialog-macro-name")},m=function(e){return e.value},p=function(e,t){if("Insert"===e){var r=o(s,m);n.reportMacroInserted(r[0].macroName)}else if("InsertCustomDialog"===e){var a=o(f,m);n.reportMacroInserted(a[0].macroName)}else if("Save"===e){var i=o(c,u);n.reportMacroEdited(i[0].macroName)}else if("SaveCustomDialog"===e){var d=o(function(){return t},function(){return t.find("#avst-custom-dialog-macro-name").attr("value")});n.reportMacroEdited(d[0].macroName)}},v=function(e){if($(e.target).is('a[class*="autocomplete-macro"] span:first-child')){var t=o(d,l);if(!t.length)return;var r=t[0];r.anyParameterRequired||n.reportMacroInserted(r.macroName)}},g=function(e){var t=e.target;if(13===e.keyCode){var r=t.matches("div.macro-input-fields form div.macro-param-div .macro-param-input"),n="submit"===t.type,a=$("#macro-details-page").is(":visible")&&1===$("#macro-details-page").find(".button-panel-button.ok").size();if(!n&&(r||a)){var o=$("div#macro-details-page div.dialog-button-panel button.button-panel-button.ok")[0];p(o.innerText)}}},y=function(){var e=$(".macro-placeholder-property-panel-remove-button"),t=o(c,u);e.size()>0&&e.one("click.removeMacro",function(){n.reportMacrosDeleted([t[0].macroName])})},b=function(e){if(46===e.keyCode||8===e.keyCode){var t=o(c,u);if(!t||!t[0])return;var r=t.map(function(e){return e.macroName});n.reportMacrosDeleted(r)}else if(13===e.keyCode){if($("#autocomplete-dropdown li.active").size()){var a=$("#autocomplete-dropdown li.active").text(),d=(l=a,i().find(function(e){return e.title===l}));d&&!d.anyParameterRequired&&n.reportMacroInserted(d.macroName)}}var l},M=function(e,t){var r=e.target;if(function(e){return e.matches("#buttongroup-dialog #insertButtonGroup")}(r)){var n=r.innerText;p(n+"CustomDialog",t)}else p(e.target.innerText)};function k(){var e;$("#editPageLink").off("click.enterEditMode",k),document.addEventListener("click",y,!0),document.addEventListener("click",v,!0),document.addEventListener("keydown",g,!0),function e(t,r){var n=$(t);if(n.size())return n.ready(function(){r(n)});window.requestAnimationFrame(function(){return e(t,r)})}("#wysiwygTextarea_ifr",function(e){(e.get(0).contentDocument||e.get(0).contentWindow.document).addEventListener("keydown",b,!0)}),e=function(e){e.find(".button-panel-button.ok")[0].addEventListener("click",M(event,e),!0)},document.addEventListener("click",function(){var t=$("#buttongroup-dialog").size()?$("#buttongroup-dialog"):$("#macro-details-page");t.size()&&"hiddenButton"!==event.target.id&&e(t)},!0)}AJS.toInit(function(){AJS.Editor.isVisible()?k():$("#editPageLink").on("click.enterEditMode",k)})}]);
}catch(e){WRMCB(e)};