WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.mxgraph.confluence.plugins.diagramly:drawio-rte', location = 'templates/soy/dialogs.soy' */
// This file was automatically generated from dialogs.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace diagramlySoy.macro.dialog.
 */

if (typeof diagramlySoy == 'undefined') { var diagramlySoy = {}; }
if (typeof diagramlySoy.macro == 'undefined') { diagramlySoy.macro = {}; }
if (typeof diagramlySoy.macro.dialog == 'undefined') { diagramlySoy.macro.dialog = {}; }


diagramlySoy.macro.dialog.searchDialog = function(opt_data, opt_ignored) {
  return '<div class="diagramly-search-dialog" id="diagramly-search-dialog"><form name="diagramly-search-form" class="aui search-form"><fieldset class="search-input"><input name="diagramly-search-field" class="text" style="max-width :450px;margin-right : 10px" type="text" size="50"/><!-- <select name="diagramly-search-space" class="diagramly-space-select select"><option value="">' + soy.$$escapeHtml('All spaces') + '</option></select>--><button type="submit" class="button submit">' + soy.$$escapeHtml('Search') + '</button></fieldset><div class="description">' + soy.$$escapeHtml('Enter the name of a diagram') + '</div></form><div class="diagramly-search-results"></div></div>';
};
if (goog.DEBUG) {
  diagramlySoy.macro.dialog.searchDialog.soyTemplateName = 'diagramlySoy.macro.dialog.searchDialog';
}


diagramlySoy.macro.dialog.importDialog = function(opt_data, opt_ignored) {
  return '<div class="diagramly-import-dialog" id="diagramly-import-dialog"><form id="diagramly-import-form" name="diagramly-import-form" class="aui import-form" method="post" action="' + soy.$$escapeHtml(opt_data.url) + '" enctype="multipart/form-data"><fieldset class="import-input"><input name="diagramly-import-field" id="diagramly-import-field" class="import-text" type="file" size="50"/></fieldset><div class="description">' + soy.$$escapeHtml('Select a Visio file (.vdx)') + '</div><div class="spinner"></div></form></div>';
};
if (goog.DEBUG) {
  diagramlySoy.macro.dialog.importDialog.soyTemplateName = 'diagramlySoy.macro.dialog.importDialog';
}


diagramlySoy.macro.dialog.searchResults = function(opt_data, opt_ignored) {
  var output = '<table class="drawio-results-table"><thead><tr class="drawio-results-header"><th class="drawio-results-column-diagramname">' + soy.$$escapeHtml('Diagram') + '</th><th class="drawio-results-column-spacename">' + soy.$$escapeHtml('Space name') + '</th><th class="drawio-results-column-lastmodified">' + soy.$$escapeHtml('Last modified') + '</th></tr></thead><tbody>';
  var diagramList24 = opt_data.diagrams;
  var diagramListLen24 = diagramList24.length;
  if (diagramListLen24 > 0) {
    for (var diagramIndex24 = 0; diagramIndex24 < diagramListLen24; diagramIndex24++) {
      var diagramData24 = diagramList24[diagramIndex24];
      output += '<tr data-attachment-id="' + soy.$$escapeHtml(diagramData24.attachmentId) + '" data-name="' + soy.$$escapeHtml(diagramData24.name) + '" data-revision="' + soy.$$escapeHtml(diagramData24.revision) + '" ><td class="drawio-results-column-diagramname">' + soy.$$escapeHtml(diagramData24.name) + '</td><td class="drawio-results-column-spacename">' + soy.$$escapeHtml(diagramData24.spaceName) + '</td><td class="drawio-results-column-lastmodified">' + soy.$$escapeHtml(diagramData24.lastModified) + '</td></tr>';
    }
  } else {
    output += '<tr data-empty="true"><td>' + soy.$$escapeHtml('drawio.search.noResults') + '</td></tr>';
  }
  output += '</tbody></table>';
  return output;
};
if (goog.DEBUG) {
  diagramlySoy.macro.dialog.searchResults.soyTemplateName = 'diagramlySoy.macro.dialog.searchResults';
}


diagramlySoy.macro.dialog.spinner = function(opt_data, opt_ignored) {
  return '<div class="diagramly-results-spinner"></div>';
};
if (goog.DEBUG) {
  diagramlySoy.macro.dialog.spinner.soyTemplateName = 'diagramlySoy.macro.dialog.spinner';
}


diagramlySoy.macro.dialog.errorMessage = function(opt_data, opt_ignored) {
  return '<div class="aui-message error shadowed"><span class="aui-icon icon-error"></span><span>' + soy.$$escapeHtml(opt_data.message) + '</span></div>';
};
if (goog.DEBUG) {
  diagramlySoy.macro.dialog.errorMessage.soyTemplateName = 'diagramlySoy.macro.dialog.errorMessage';
}


diagramlySoy.macro.dialog.newDiagramWizard = function(opt_data, opt_ignored) {
  return '<div class="diagramly-blueprint-list" ><div class="diagramly-blueprint-list-item-wrapper" ><div id="blank" class="diagramly-blueprint-list-item"></div><span>' + soy.$$escapeHtml('Blank') + '</span></div><div style="margin-top : 35px;margin-bottom : 25px; width : 100%; height : 1px; border : 1px solid #c5c5c5;"></div><div  class="diagramly-blueprint-list-item-wrapper" ><img id="search" class="diagramly-blueprint-list-item" height="80px" length="80px" src="' + soy.$$escapeHtml(opt_data.imageUrlBase) + '/search.png"></img><span>' + soy.$$escapeHtml('Search') + '</span></div>';
};
if (goog.DEBUG) {
  diagramlySoy.macro.dialog.newDiagramWizard.soyTemplateName = 'diagramlySoy.macro.dialog.newDiagramWizard';
}


diagramlySoy.macro.dialog.newDiagram = function(opt_data, opt_ignored) {
  return '<div id="drawio-newdiagram-panel" class="drawio-newdiagram-panel" ><div class="drawio-list" ><div class="drawio-list-item" data-blank="true"></div><span>' + soy.$$escapeHtml('Blank') + '</span></div><div class="drawio-separator"></div><div >' + soy.$$escapeHtml('Recent diagrams') + ' :</div><div class="drawio-search-results"></div></div>';
};
if (goog.DEBUG) {
  diagramlySoy.macro.dialog.newDiagram.soyTemplateName = 'diagramlySoy.macro.dialog.newDiagram';
}


diagramlySoy.macro.dialog.diagramThumbnails = function(opt_data, opt_ignored) {
  var output = '<div>';
  var diagramList66 = opt_data.diagrams;
  var diagramListLen66 = diagramList66.length;
  for (var diagramIndex66 = 0; diagramIndex66 < diagramListLen66; diagramIndex66++) {
    var diagramData66 = diagramList66[diagramIndex66];
    output += '<div class="drawio-list" ><div class="drawio-list-item drawio-thumbnail" style="background-image:url(\'' + soy.$$escapeHtml(diagramData66.thumbnailURL) + '\')" data-diagramname="' + soy.$$escapeHtml(diagramData66.name) + '" data-ceoid="' + soy.$$escapeHtml(diagramData66.pageId) + '" data-revision="' + soy.$$escapeHtml(diagramData66.revision) + '" data-mimetype="' + soy.$$escapeHtml(diagramData66.mimeType) + '"></div><div style="max-height : 35px; overflow : hidden;font-size : 13px; word-wrap : break-word">' + soy.$$escapeHtml(diagramData66.name) + '</div></div>';
  }
  output += '</div>';
  return output;
};
if (goog.DEBUG) {
  diagramlySoy.macro.dialog.diagramThumbnails.soyTemplateName = 'diagramlySoy.macro.dialog.diagramThumbnails';
}


diagramlySoy.macro.dialog.templateThumbnails = function(opt_data, opt_ignored) {
  var output = '<div>';
  var templateNameList84 = opt_data.templateNames;
  var templateNameListLen84 = templateNameList84.length;
  for (var templateNameIndex84 = 0; templateNameIndex84 < templateNameListLen84; templateNameIndex84++) {
    var templateNameData84 = templateNameList84[templateNameIndex84];
    output += '<div class="drawio-list" ><div class="drawio-list-item drawio-thumbnail" style="background-image:url(\'' + soy.$$escapeHtml(opt_data.downloadPath) + '/' + soy.$$escapeHtml(templateNameData84.name) + '.png\')" data-templateurl="' + soy.$$escapeHtml(templateNameData84.fullDownloadPath) + '"></div><div class="description" style="max-height : 35px; overflow : hidden;font-size : 13px;text-transform:capitalize;">' + soy.$$escapeHtml(templateNameData84.displayName) + '</div></div>';
  }
  output += '</div>';
  return output;
};
if (goog.DEBUG) {
  diagramlySoy.macro.dialog.templateThumbnails.soyTemplateName = 'diagramlySoy.macro.dialog.templateThumbnails';
}


diagramlySoy.macro.dialog.customTemplateThumbnails = function(opt_data, opt_ignored) {
  var output = '<div>';
  var templateList98 = opt_data.templates;
  var templateListLen98 = templateList98.length;
  for (var templateIndex98 = 0; templateIndex98 < templateListLen98; templateIndex98++) {
    var templateData98 = templateList98[templateIndex98];
    output += '<div class="drawio-list" ><div class="drawio-list-item drawio-thumbnail" style="background-image:url(\'' + soy.$$escapeHtml(templateData98.imagePath) + '\')" data-templateurl="' + soy.$$escapeHtml(templateData98.path) + '"></div><div class="description" style="max-height : 35px; overflow : hidden;font-size : 13px;text-transform:capitalize;">' + soy.$$escapeHtml(templateData98.name) + '</div></div>';
  }
  output += '</div>';
  return output;
};
if (goog.DEBUG) {
  diagramlySoy.macro.dialog.customTemplateThumbnails.soyTemplateName = 'diagramlySoy.macro.dialog.customTemplateThumbnails';
}


diagramlySoy.macro.dialog.macroSettings = function(opt_data, opt_ignored) {
  return '<form action="#" method="post" name="drawio-macro-settings"><fieldset><div style="margin: 12px 0 0 12px;"><label for="drawio-macro-width">' + soy.$$escapeHtml('Width') + ': </label><input id="drawio-macro-width" name="drawio-macro-width" size="5" type="text" value="' + soy.$$escapeHtml(opt_data.settings.width) + '"/>&nbsp &nbsp<label for="drawio-macro-tbstyle">' + soy.$$escapeHtml('Toolbar') + ': </label><select id="drawio-macro-tbstyle" name="drawio-macro-tbstyle"><option value="top" ' + ((opt_data.settings.tbstyle != 'embed' && opt_data.settings.tbstyle != 'hidden') ? 'selected="selected"' : '') + '>' + soy.$$escapeHtml('Top') + '</option><option value="inline" ' + ((opt_data.settings.tbstyle == 'inline') ? 'selected="selected"' : '') + '>' + soy.$$escapeHtml('Embed') + '</option><option value="hidden" ' + ((opt_data.settings.tbstyle == 'hidden') ? 'selected="selected"' : '') + '>' + soy.$$escapeHtml('Hidden') + '</option></select></div><div style="margin: 12px 0 0 12px;"><label for="drawio-macro-border">' + soy.$$escapeHtml('Border') + ' </label><input id="drawio-macro-border" name="drawio-macro-border" type="checkbox" ' + ((opt_data.settings.border == true) ? 'checked ' : '') + '/>&nbsp &nbsp<label for="drawio-macro-lightbox">' + soy.$$escapeHtml('Lightbox') + ' </label><input id="drawio-macro-lightbox" name="drawio-macro-lightbox" type="checkbox" ' + ((opt_data.settings.lbox == true) ? 'checked ' : '') + '/>&nbsp &nbsp<label for="drawio-macro-simpleViewer">' + soy.$$escapeHtml('Simple Viewer') + ' </label><input id="drawio-macro-simpleViewer" name="drawio-macro-simpleViewer" type="checkbox" ' + ((opt_data.settings.simpleViewer == true) ? 'checked ' : '') + '/></div><div style="margin: 12px 0 0 12px;"><label for="drawio-macro-links">' + soy.$$escapeHtml('Links') + ': </label><select id="drawio-macro-links" name="drawio-macro-links"><option value="auto" ' + ((opt_data.settings.links != 'blank' && opt_data.settings.links != 'self') ? 'selected="selected"' : '') + '>' + soy.$$escapeHtml('Automatic') + '</option><option value="blank" ' + ((opt_data.settings.links == 'blank') ? 'selected="selected"' : '') + '>' + soy.$$escapeHtml('Open in New Window') + '</option><option value="self" ' + ((opt_data.settings.links == 'self') ? 'selected="selected"' : '') + '>' + soy.$$escapeHtml('Open in This Window') + '</option></select></div><div style="margin: 12px 0 0 12px;"><label for="diagram-display-name">' + soy.$$escapeHtml('Diagram Title') + ': </label><input id="diagram-display-name" name="diagram-display-name" type="text" size="23" ' + ((opt_data.settings.diagramDisplayName) ? ' value="' + soy.$$escapeHtml(opt_data.settings.diagramDisplayName) + '" ' : '') + '/></div><div style="margin: 12px 0 0 12px;"><button id="drawio-aspect-selection" class="aui-button" >' + soy.$$escapeHtml('Select viewer page and layers') + '</button></div><div style="margin: 12px 0 0 12px; color : red;" id="drawioMacroMessageContainer"></div></fieldset></form>';
};
if (goog.DEBUG) {
  diagramlySoy.macro.dialog.macroSettings.soyTemplateName = 'diagramlySoy.macro.dialog.macroSettings';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.mxgraph.confluence.plugins.diagramly:drawio-rte', location = 'js/DiagramlyUtils.js' */
AJS.bind("init.rte",function(a){(function(b){window.MXGRAPH=window.MXGRAPH||{};MXGRAPH.confluence=MXGRAPH.confluence||{};MXGRAPH.confluence.serviceEndpoint=AJS.format("{0}/rest/drawio/1.0",AJS.Confluence.getContextPath());MXGRAPH.confluence.templatesUrlRoot="/download/resources/com.mxgraph.confluence.plugins.diagramly:drawio-editor/templates/diagramtemplates";MXGRAPH.configuration={};MXGRAPH.confluence.parseErrorMessage=function(f){if(f.responseText!=null){try{var c=b.parseJSON(f.responseText);return(c.message!=null)?c.message:f.responseText}catch(d){return f.responseText}}return""};MXGRAPH.confluence.urlParams=(function(e){var d=new Object();var c=e.lastIndexOf("?");if(c>0){var g=e.substring(c+1).split("&");for(var f=0;f<g.length;f++){c=g[f].indexOf("=");if(c>0){d[g[f].substring(0,c)]=g[f].substring(c+1)}}}return d})(window.location.href);MXGRAPH.confluence.getMacroParamsObject=function(c,d){var f={};var e=AJS.$(c).attr("data-macro-parameters");e=e||"";var h=e.split("|");AJS.$.each(h,function(j,m){var i=m.indexOf("=");if(i>0){var k=m.substring(0,i);var l=m.substring(i+1);if(l=="true"){l=true}if(l=="false"){l=false}f[k]=l}});if(d){var g=MXGRAPH.confluence.getDefaultMacroParamsObject();for(param in g){if(f[param]==null){f[param]=g[param]}}}return f};MXGRAPH.confluence.getDefaultMacroParamsObject=function(){var h=MXGRAPH.configuration.uiConfig!=null&&MXGRAPH.configuration.uiConfig.defaultMacroParameters!=null?MXGRAPH.configuration.uiConfig.defaultMacroParameters:null;h=h||{};var c=h.border!=null?h.border:true;var g=h.toolbarStyle!=null?h.toolbarStyle:"top";var f=h.simpleViewer!=null?h.simpleViewer:false;var e=h.width!=null?h.width:"";var i=h.lightbox!=null?h.lightbox:true;var d=h.links!=null?h.links:"auto";return{width:e,border:c,tbstyle:g,simpleViewer:f,lbox:i,links:d}};MXGRAPH.confluence.macroParamsObjectToString=function(c){var d=[];for(param in c){d.push(param+"="+c[param])}return d.join("|")};MXGRAPH.confluence.getConfiguration=function(){return b.ajax({type:"GET",url:MXGRAPH.confluence.serviceEndpoint+"/config",dataType:"json"})};MXGRAPH.confluence.loadDiagram=function(c,f,e,g,d){e=e!=null?"?revision="+e:"";b.ajax({type:"GET",url:MXGRAPH.confluence.serviceEndpoint+"/diagram/crud/"+f+"/"+c+e,dataType:"json",success:g,error:d})}}(AJS.$))});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.mxgraph.confluence.plugins.diagramly:drawio-rte', location = 'js/DrawioMacroButtonHandlers.js' */
AJS.bind("init.rte",function(a){MXGRAPH.confluence.getConfiguration().done(function(b){MXGRAPH.configuration.uiConfig=b!=null&&b.uiConfig!=null&&b.uiConfig.length>0?JSON.parse(b.uiConfig):{}}).always(function(){$=AJS.$;var f=function(k,h){AJS.Rte.BookmarkManager.storeBookmark();var j=new AJS.Dialog({width:405,height:345,id:"drawio-macro-dialog",closeOnOutsideClick:false});var g=MXGRAPH.confluence.getMacroParamsObject(h,true);g.diagramDisplayName=(g.diagramDisplayName!=null)?g.diagramDisplayName:"";function l(m){g.aspect=m}function i(){g.aspect=null}j.addHeader("draw.io Macro Settings");j.addPanel("",diagramlySoy.macro.dialog.macroSettings({settings:g}),"");j.addButton("Save",function(m){var n=parseInt($("#drawio-macro-width").attr("value"));if(isNaN(n)){g.width=""}else{g.width=n}g.diagramDisplayName=$("#diagram-display-name").attr("value");if(/[&\*+=\\;/{}|\":<>\?]/g.test(g.diagramDisplayName)){$("#drawioMacroMessageContainer").html("Diagram titles must not contain the following characters: \u005C / | : ; { } \u003c \u003e & + ? = \u0022");m.updateHeight();return}g.border=$("#drawio-macro-border").is(":checked");g.simpleViewer=$("#drawio-macro-simpleViewer").is(":checked");g.lbox=$("#drawio-macro-lightbox").is(":checked");g.tbstyle=$("#drawio-macro-tbstyle").attr("value");g.links=$("#drawio-macro-links").attr("value");var p={contentId:Confluence.Editor.getContentId(),macro:{name:"drawio",params:g,defaultParameterValue:"",body:""}};if(g.aspect!=null){var o=DiagramUtils.createAspectPreview(g.pageId||Confluence.Editor.getContentId(),g.diagramName,g.revision,g.aspect);o.done(function(q){g.aspectHash=q.aspectHash;tinymce.confluence.MacroUtils.insertMacro(p,h).always(function(){m.remove()})}).fail(function(q){AJS.flag({type:"error",body:"There was an error generating a diagram preview. Please consult technical support."})})}else{tinymce.confluence.MacroUtils.insertMacro(p,h).always(function(){m.remove()})}});j.addCancel("Close",function(m){m.remove()});$("#drawio-aspect-selection").click(function(){require(["drawio/aspect-dialog"],function(m){new m(h,l,i).create().show()})});$("form[name='drawio-macro-settings']").live("submit",function(m){m.preventDefault();return false});j.popup.element.css("zIndex",3000);j.popup.element.css("marginTop",-250);j.show();$("#drawio-macro-simpleViewer").change(function(){$("#drawio-macro-tbstyle").prop("disabled",$(this).prop("checked"))})};AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("dupe-diagram",function(m,g){var j=MXGRAPH.confluence.getMacroParamsObject(g);var i=j.revision||0;if(j.aspect!=null&&j.aspect.length>0){alert("Diagram duplication is disabled when page and layers are selected");return}var k=window.prompt("Please enter the name","Copy of "+j.diagramName);if(k!=null&&k!=""){var l="&owningPageId="+(j.pageId!=null?j.pageId:Confluence.Editor.getContentId());var h="ceoId="+Confluence.Editor.getContentId()+l+"&originalDiagramName="+encodeURIComponent(j.diagramName)+"&newDiagramName="+encodeURIComponent(k)+"&revision="+i;$.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:MXGRAPH.confluence.serviceEndpoint+"/diagram/duplicate.json?"+h,dataType:"json",success:function(p){var o=AJS.$(g).clone();j.diagramName=k;if(j.pageId!=null){delete j.pageId}j.revision=1;var n=MXGRAPH.confluence.macroParamsObjectToString(j);o[0].setAttribute("data-macro-parameters",n);o.insertAfter(AJS.$(g))},error:function(p,n,o){if(o=="Conflict"){alert("Could not duplicate diagram. Please choose a different name.")}else{if(o=="Forbidden"){alert("Owning page access restriction: cannot duplicate diagram. ")}else{alert("Could not duplicate diagram. Please try again later.")}}}})}});var d=function(g,h){var j=MXGRAPH.confluence.getMacroParamsObject(g,false);if(h=="original"){j.width=""}else{j.width=h}var i={contentId:Confluence.Editor.getContentId(),macro:{name:"drawio",params:j,defaultParameterValue:"",body:""}};tinymce.confluence.MacroUtils.insertMacro(i,g)};var b=function(i){var h=i.params||MXGRAPH.confluence.getDefaultMacroParamsObject();h.width=h.width||"";if(h.diagramName!=null){if(h.pageId!=null){var g=new AJS.Dialog({closeOnOutsideClick:true,width:450,height:220,id:"draw-message"});g.addButton("Edit owning page",function(){window.open(Confluence.getContextPath()+"/pages/editpage.action?pageId="+h.pageId,"_blank")});g.addCancel("Close",function(){g.hide()});g.addHeader("Cannot edit linked diagram").addPanel("Panel","","drawio-message-contents");$(".drawio-message-contents").html("Diagram can only be edited from the page that owns it. Would you like to open the owning page for edit?");g.show()}else{MXGRAPH.confluence.openEditor(h)}}else{if(i.params!=null){MXGRAPH.confluence.openEditor(h)}else{MXGRAPH.confluence.getSplashDialog().show()}}};var c=function(g){if(g.params!=null){e()}else{MXGRAPH.confluence.getSplashDialog().show()}};function e(){var g=new AJS.Dialog({width:400,height:200,id:"cannoteditfromtemplatesdialog",closeOnOutsideClick:true});g.addCancel("Close",function(){g.hide()});g.addHeader("draw.io diagrams in templates").addPanel("Panel","","drawio-message-contents");$(".drawio-message-contents").html("Diagrams in page templates cannot be edited. They can only be edited on pages and blog posts.");g.show()}if(AJS.Meta.get("form-name")==="createpagetemplate"||AJS.Meta.get("form-name")==="editpagetemplate"){AJS.MacroBrowser.setMacroJsOverride("drawio",{opener:c});AJS.MacroBrowser.setMacroJsOverride("diagramly",{opener:c})}else{AJS.MacroBrowser.setMacroJsOverride("drawio",{opener:b});AJS.MacroBrowser.setMacroJsOverride("diagramly",{opener:b})}AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("edit-macro",f);AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("drawio-size-small",function(h,g){d(g,200)});AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("drawio-size-medium",function(h,g){d(g,400)});AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("drawio-size-large",function(h,g){d(g,600)});AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("drawio-size-original",function(h,g){d(g,"original")})})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.mxgraph.confluence.plugins.diagramly:drawio-rte', location = 'js/DiagramlyPageEditor.js' */
AJS.bind("init.rte",function(a){(function(c){c("form[name='diagramly-search-form']").live("submit",function(){AJS.trigger("diagramly.search.perform",[c(this)]);return false});var f=null;c("input[name='diagramly-search-field']").live("keyup",function(e){if(f){clearInterval(f)}f=setTimeout(function(){AJS.trigger("diagramly.search.perform",[c("form[name='diagramly-search-form']")])},500)});MXGRAPH.confluence.openEditor=function(k){var l="";var h=Confluence.Editor.getContentId();var m=k.ceoId!=null?k.ceoId:Confluence.Editor.getContentId();var i=MXGRAPH.isComment();l+=k.diagramName!=null?"&diagramName="+encodeURIComponent(k.diagramName):"";l+=k.templateUrl!=null?"&templateUrl="+k.templateUrl:"";l+=k.useAsTemplate?"&useAsTemplate=true":"";l+=k.revision!=null?"&revision="+k.revision:"";if(i){l+="&ignoreRevisioning=1"}if(k.aspect!=null){var e=k.aspect.split(" ")[0];l+="&page-id="+e}l+=k.mimeType=="application/gliffy+json"?"&import=true":"";var j=AJS.Confluence.getContextPath()+"/plugins/drawio/addDiagram.action?ceoId="+h+"&owningPageId="+m;var g=c('<iframe id="drawioEditor" >');g.appendTo("body");g.css({position:"fixed",width:"100%",height:"100%",top:"0px",left:"0px","border-style":"none",zIndex:1000});g.attr("src",j+l);MXGRAPH.editorFrame=g};MXGRAPH.closeEditor=function(){MXGRAPH.editorFrame.remove();document.body.style.overflow="auto"};MXGRAPH.isComment=function(){var e=window.frames.wysiwygTextarea_ifr.parentElement||window.frames.wysiwygTextarea_ifr.frameElement.parentNode;while(e!=null){if(e.name=="inlinecommentform"){return true}e=e.parentNode}return false};MXGRAPH.restoreFocus=function(){var e=MXGRAPH.editorFrame!=null?MXGRAPH.editorFrame[0]:null;if(e&&e.contentWindow){e.contentWindow.focus()}};MXGRAPH.confluence.insertMacro=function(g,k,m,n,i,e){var j=MXGRAPH.confluence.getDefaultMacroParamsObject();if(g!=null){j.diagramName=g}if(m!=null){j.revision=m}if(n!=null){j.diagramWidth=n}if(i!=null){j.templateUrl=i}if(k!=null&&Confluence.Editor.getContentId()!=k){j.pageId=k}if(e!=null){j.aspect=e}var h={contentId:Confluence.Editor.getContentId(),macro:{name:"drawio",params:j,defaultParameterValue:"",body:""}};AJS.Rte.BookmarkManager.restoreBookmark();var l=tinymce.confluence.MacroUtils.insertMacro(h);l.done(function(){MXGRAPH.restoreFocus()});return l};MXGRAPH.postSave=function(e,k,h,g){var j=c(AJS.Rte.getEditor().dom.select(".editor-inline-macro")).filter(function(l){return c(this).data("macro-name")==="drawio"||c(this).data("macro-name")==="diagramly"});var i=[];j.each(function(m,o){var p=c(this);var n=MXGRAPH.confluence.getMacroParamsObject(p,false);n.revision=h;n.diagramWidth=g;if(n.diagramName!=k){return true}var q={contentId:Confluence.Editor.getContentId(),macro:{name:p.data("macro-name"),params:n,body:"",defaultParameterValue:""}};var l=MXGRAPH.confluence.refreshMacro(q,p);i.push(l)});return c.when.apply(c,i)};MXGRAPH.confluence.refreshMacro=function(g,e){var h=c.ajax({url:Confluence.getContextPath()+"/rest/tinymce/1/macro/placeholder",type:"POST",contentType:"application/json; charset=utf-8",data:c.toJSON(g),dataType:"text"});h.done(function(i){var j=c(i);j.attr("src",j.attr("src")+"#"+new Date().getTime());e.replaceWith(j[0])});return h};MXGRAPH.confluence.splashDialog=null;MXGRAPH.confluence.createSplashDialog=function(){var o={};var m=window.location.pathname.indexOf("createpagetemplate.action")!=-1||window.location.pathname.indexOf("editpagetemplate.action")!=-1;var h=function(r){MXGRAPH.confluence.openEditor(r)};var j=new AJS.Dialog({width:800,height:600,id:"drawio-macro-dialog",closeOnOutsideClick:true});j.addHeader("draw.io");j.addPanel("draw.io Diagram",diagramlySoy.macro.dialog.newDiagram(),"singlePanel");j.addPanel("Search",diagramlySoy.macro.dialog.searchDialog());j.addButton("Link to Diagram",function(r){success=function(x){var t=(o.ceoId==Confluence.Editor.getContentId())?x.revision:null;var v=null;var s=c("<div style='position : absolute'></div>");try{v=DiagramUtils.createGraph(x.xml,s[0],0);var u=v.getGraphBounds().width;MXGRAPH.confluence.insertMacro(o.diagramName,o.ceoId,t,u)}catch(w){console.log(w);MXGRAPH.confluence.insertMacro(o.diagramName,o.ceoId,t)}finally{if(v!=null){v.destroy()}s.remove();r.hide()}};error=function(s){console.log(s);MXGRAPH.confluence.insertMacro(o.diagramName,o.ceoId);r.hide()};MXGRAPH.confluence.loadDiagram(o.ceoId,o.diagramName,null,success,error)});j.addButton("Select",function(r){l()});function l(){if(m){if(Object.keys(o)==0){MXGRAPH.confluence.insertMacro()}else{var r=o.templateUrl!=null?o.templateUrl:"/download/attachments/"+o.ceoId+"/"+encodeURIComponent(o.diagramName);MXGRAPH.confluence.insertMacro(null,null,null,null,r)}}else{h(o)}j.hide()}j.addCancel("Cancel",function(r){r.hide()});AJS.$("#drawio-blank").addClass("drawio--list-item-selected");var i=function(r){if(r){j.getPage(j.curpage).button[0].item.show()}else{j.getPage(j.curpage).button[0].item.hide()}};var p=function(s){var r=j.getPage(j.curpage).button[1].item;if(s=="blank"){r.html("Select")}else{if(s=="copy"){r.html("Copy")}else{if(s=="import"){r.html("Import")}}}};i(false);var e=function(){AJS.$(".drawio-list-item").unbind();AJS.$(".drawio-list-item").mouseover(function(r){AJS.$(".drawio-list-item").removeClass("drawio-list-item-hover");AJS.$(r.target).addClass("drawio-list-item-hover")});AJS.$(".drawio-list-item").mouseout(function(r){AJS.$(".drawio-list-item").removeClass("drawio-list-item-hover")});AJS.$(".drawio-list-item").dblclick(function(){l()});AJS.$(".drawio-list-item").click(function(s){AJS.$(".drawio-list-item").removeClass("drawio-list-item-selected");AJS.$(s.target).removeClass("drawio-list-item-hover");AJS.$(s.target).addClass("drawio-list-item-selected");var u=s.target.dataset.diagramname;var t=s.target.dataset.templateurl;o={};i(false);p("blank");if(u!=null){o.diagramName=u;o.ceoId=s.target.dataset.ceoid;o.revision=s.target.dataset.revision;o.mimeType=s.target.dataset.mimetype;var r=o.mimeType=="application/gliffy+json";o.useAsTemplate=true;if(r){p("import")}else{p("copy");i(true)}}else{if(t!=null){o.templateUrl=t;o.useAsTemplate=true;i(false);p("copy")}}})};e();var q=function(v,u,r,t,s){c.ajax({data:{diagramName:v,spaceKey:u,currentUser:r,maxResults:t},url:MXGRAPH.confluence.serviceEndpoint+"/diagramSearch.json"+(m?"?diagramTypes=drawio":""),dataType:"json",success:function(w){s.empty().append(diagramlySoy.macro.dialog.diagramThumbnails({diagrams:w}));e()},error:function(A,w,z){var y=MXGRAPH.confluence.parseErrorMessage(A);var x=AJS.format("Error during search. Specified reason",y);s.empty().append(diagramlySoy.macro.dialog.errorMessage({message:"There has been an error during the search"}))}})};q("","",true,10,AJS.$("#drawio-newdiagram-panel").find(".drawio-search-results"));AJS.bind("diagramly.search.perform",function(w,u){var s=u.closest(".diagramly-search-dialog");var r=s.find(".diagramly-search-results");r.empty().append(diagramlySoy.macro.dialog.spinner());Raphael.spinner(r.find(".diagramly-results-spinner").get(0),55,"#B5B5B5");var t=s.closest(".aui-dialog").find(".button-panel-button");var x=c.trim(s.find("input[name='diagramly-search-field']").val());var v=s.find("select[name='diagramly-search-space']").val();q(x,v,false,100,r)});var n={};var g={business:"Business",charts:"Charts",cloud:"Cloud",engineering:"Engineering",flowcharts:"Flowcharts",network:"Network",other:"Other",software:"Software",venn:"Venn",gcp:"GCP",layout:"Layout",maps:"Maps",tables:"Tables",uml:"Uml"};addHeader=function(t){j.addPanel(t);var s=j.page[0].panel[j.page[0].panel.length-1];var r=AJS.$(s.button[0].parentElement);r.empty().append("<div class='drawio-template-panel-header'>"+t+"</div>")};$customTemplates=c.ajax({url:MXGRAPH.confluence.serviceEndpoint+"/customtemplates/sections"});var k=c.ajax({url:AJS.Confluence.getContextPath()+MXGRAPH.confluence.templatesUrlRoot+"/index.xml"});c.when.apply(c,[$customTemplates,k]).done(function(w,C){if(w[2].status==200){if(w[0]!=null){templateSections=w[0];if(Object.keys(templateSections).length>0){addHeader("Custom Templates")}for(var B in templateSections){if(templateSections.hasOwnProperty(B)){var E=templateSections[B];for(var A=0;A<E.length;A++){var D=E[A];D.imagePath=AJS.contextPath()+D.imagePath}j.addPanel(B+" ("+E.length+")",diagramlySoy.macro.dialog.customTemplateThumbnails({templates:E}),"")}}}else{}}else{console.log("Failed to load custom templates, status : "+w[2].status)}addHeader("draw.io Templates");if(C[2].status==200){var z=C[0];for(var A=0;A<z.firstChild.childNodes.length;A++){var D=z.firstChild.childNodes[A];if(D.nodeType!=1){continue}var s=D.getAttribute("url");var v=s.split("/");var u=v[0];var t=g[D.getAttribute("category")];var F=v[1].split(".")[0];var y=v[1].split(".")[0].replace(/_/g," ");var x=MXGRAPH.confluence.templatesUrlRoot+"/"+u+"/"+F+".xml";var r={name:F,displayName:y,categoryDisplayName:t,fullDownloadPath:x};if(n[u]==null){n[u]=[]}n[u].push(r)}for(var u in n){j.addPanel(n[u][0].categoryDisplayName+" ("+n[u].length+")",diagramlySoy.macro.dialog.templateThumbnails({templateNames:n[u],downloadPath:AJS.contextPath()+MXGRAPH.confluence.templatesUrlRoot+"/"+u}),"")}}e()}).always(function(){j.gotoPanel(0,0)});return j};MXGRAPH.confluence.getSplashDialog=function(){if(MXGRAPH.confluence.splashDialog==null){MXGRAPH.confluence.splashDialog=MXGRAPH.confluence.createSplashDialog()}return MXGRAPH.confluence.splashDialog};if(MXGRAPH.confluence.urlParams.diagramlyBlueprint){MXGRAPH.confluence.getSplashDialog().show()}try{if(window.location.pathname.indexOf("copypage.action")>-1||window.location.pathname.indexOf("createpage.action")>-1){var b=c(AJS.Rte.getEditor().dom.select(".editor-inline-macro")).filter(function(e){return c(this).data("macro-name")==="drawio"||c(this).data("macro-name")==="diagramly"});b.each(function(e,g){var i=MXGRAPH.confluence.getMacroParamsObject(g,false);if(i.pageId!=null){return}if(tinymce.confluence.MacroUtils.updateMacro){i.revision=1;tinymce.confluence.MacroUtils.updateMacro(i,"","drawio",g)}else{var h=c(g).attr("data-macro-parameters");if(h.match(/revision=\d+/)!=null){c(g).attr("data-macro-parameters",h.replace(/revision=\d+/,"revision=1"))}}})}if(window.location.pathname.indexOf("createpage-entervariables.action")>-1){}}catch(d){console.log("draw.io : revision reset for copied page has failed",d)}}(AJS.$))});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.mxgraph.confluence.plugins.diagramly:drawio-rte', location = 'js/AspectDialog.js' */
define("drawio/aspect-dialog",["jquery","ajs","aui/templates"],function(c,a,b){function d(e,g,f){params=MXGRAPH.confluence.getMacroParamsObject(e);this.ceoId=params.pageId!=null?params.pageId:Confluence.Editor.getContentId();this.diagramName=params.diagramName;this.revision=params.revision;this.macroNode=e;this.aspect={pageId:null,layerIds:[]};this.selectAspectCallback=g;this.removeAspectCallback=f;if(params.aspect!=null&&params.aspect.length>0){aspectArray=params.aspect.split(" ");this.aspect.pageId=aspectArray[0];this.aspect.layerIds=aspectArray.slice(1)}this.viewers={}}d.prototype.ceoId;d.prototype.diagramName;d.prototype.revision;d.prototype.aspect;d.prototype.dialog2;d.prototype.applyBtn;d.prototype.aspect;d.prototype.createChrome=function(){dialog=this;var i=b.buttons.button({type:"link",id:"close-aspect-dialog",text:"Close"});var g=b.buttons.button({type:"button",id:"apply-aspect-dialog",text:"Apply"});var f=b.buttons.button({type:"button",id:"remove-aspect-dialog",text:"Delete"});var e='<span class="button-spinner" style="display: inline-block; height: 10px; width: 20px; margin-right : 5px"></span>';var h='<div id="messageContainer"></div>';this.$chrome=c(b.dialog.dialog2({id:"drawio-aspect-dialog",modal:true,titleText:"Select Page and Layers",footerActionContent:h+e+g+f+i,size:"xlarge"}));this.applyBtn=this.$chrome.find("#apply-aspect-dialog");if(this.aspect.pageId==null){this.applyBtn.attr("disabled",true);this.$chrome.find("#remove-aspect-dialog").attr("disabled",true)}this.$chrome.on("click","#close-aspect-dialog",c.proxy(function(){this.destroy();c(".aui-blanket").attr("aria-hidden",false)},this));this.$chrome.on("click","#apply-aspect-dialog",function(){page=$pagesPane.find(".drawio-aspect-list-item-selected");layers=$layersPane.find(".drawio-aspect-list-item-selected");aspect=page.data("page-id");for(var j=0;j<layers.length;j++){aspect+=" "+c(layers[j]).data("layer-id")}dialog.selectAspectCallback(aspect);dialog.destroy()});this.$chrome.on("click","#remove-aspect-dialog",function(){dialog.removeAspectCallback();dialog.destroy()});return this.$chrome};d.prototype.create=function(){dialog=this;var e=dialog.createChrome();$content=e.find(".aui-dialog2-content");$pagesPane=c("<div class='drawio-aspect-list'></div>");$layersPane=c("<div class='drawio-aspect-list'></div>");$content.append($pagesPane);$content.append($layersPane);DiagramUtils.loadDiagram(this.ceoId,this.diagramName,this.revision).done(function(l){try{var g=mxUtils.parseXml(l.xml);var h=new mxGraphModel();var k=g.documentElement;if(k.nodeName=="mxfile"){diagramEls=g.getElementsByTagName("diagram");for(var f=0;f<diagramEls.length;f++){graphString=Graph.prototype.decompress(diagramEls[f].textContent);g=mxUtils.parseXml(graphString);dialog.createPageItem($pagesPane,$layersPane,diagramEls[f].attributes.id.textContent,diagramEls[f].attributes.name.textContent,g.documentElement,graphString)}}else{dialog.createPageItem($pagesPane,$layersPane,"","",k,l.xml)}$pagesPane.prepend(c("<h5>"+"Pages"+"</h5>"))}catch(j){console.log(j);dialog.setMessage("error","","There was an error generating a diagram preview. Please consult technical support.")}dialog.setSpinnerStatus(false)}).fail(function(f){dialog.setSpinnerStatus(false);dialog.setMessage("error","","Diagram attachment access error: cannot display diagram");dialog.applyBtn.attr("disabled",true)});dialog.setSpinnerStatus(true);this.dialog2=a.dialog2(e);return this.dialog2};d.prototype.createPageItem=function(h,k,g,f,e,i){$listItem=c("<div data-page-id='"+g+"' class='drawio-aspect-list-item'><div style='max-width:100%;max-height : 100%;'></div><div class='drawio-aspect-list-item-text'>"+f+"</div></div>");h.append($listItem);dialog=this;var j=new GraphViewer($listItem.children(":first")[0],e,{lightbox:false,"max-height":110,"allow-zoom-in":false});onClick=function(){h.find(".drawio-aspect-list-item-selected").removeClass("drawio-aspect-list-item-selected");c(this).addClass("drawio-aspect-list-item-selected");dialog.applyBtn.attr("disabled",false);k.empty();dialog.setSpinnerStatus(true);dialog.createLayerList(k,g,j.graph.model,i);dialog.setSpinnerStatus(false)};$listItem.on("click",onClick);this.addHoverHandlers(h);if(this.aspect.pageId==g){onClick.apply($listItem)}};d.prototype.createLayerList=function(j,e,h,g){layers=h.getChildCells(h.getRoot());$container=c("<div id='"+e+"'></div>");for(var f=0;f<layers.length;f++){layer=layers[f];layerName="";if(layer.value!=null){if(typeof layer.value==="string"){layerName=layer.value}else{if(typeof layer.value==="object"&&layer.value.attributes!=null&&layer.value.attributes.label!=null){layerName=layer.value.attributes.label.textContent}}}$listItem=c("<div data-layer-id='"+layer.id+"' class='drawio-aspect-list-item'><div style='max-width:100%;max-height : 100%;'></div><div class='drawio-aspect-list-item-text'>"+layerName+"</div></div>");j.append($listItem);node=mxUtils.parseXml(g);layerIdx=h.getRoot().getIndex(h.getCell(layer.id));new GraphViewer($listItem.children(":first")[0],node.documentElement,{lightbox:false,"allow-zoom-in":false,"max-height":110,layers:layerIdx+""});onClick=function(){c(this).toggleClass("drawio-aspect-list-item-selected")};$listItem.on("click",onClick);if(this.aspect.layerIds.indexOf(layer.id)!=-1){onClick.apply($listItem)}}j.prepend(c("<h5>"+"Layers"+"</h5>"));this.addHoverHandlers(j)};d.prototype.addHoverHandlers=function(e){e.find(".drawio-aspect-list-item").on("mouseover",function(f){c(this).addClass("drawio-aspect-list-item-hover")}).on("mouseout",function(){c(this).removeClass("drawio-aspect-list-item-hover")})};d.prototype.setSpinnerStatus=function(e){e?this.$chrome.find(".button-spinner").spin():this.$chrome.find(".button-spinner").spinStop()};d.prototype.destroy=function(){this.dialog2.remove()};d.prototype.setMessage=function(f,e,g){a.messages[f](".aui-dialog2-content",{title:e,body:g})};return d});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.mxgraph.confluence.plugins.diagramly:drawio-rte', location = 'js/DiagramUtils.js' */
DiagramUtils={serviceEndpoint:(typeof DrawioProperties!=="undefined"?DrawioProperties.contextPath:AJS.contextPath())+"/rest/drawio/1.0",aspectRegistry:{},createAspectPreview:function(b,d,c,a){$createAspectD=$.Deferred();DiagramUtils.aspectRegistry[a]=$createAspectD;$createAspectD.aspect=a;DiagramUtils.loadDiagram(b,d,c).done(function(k){aspectArray=a.split(" ");pageId=aspectArray[0];layerIds=aspectArray.length>1?aspectArray.slice(1):null;var e=$("<div ></div>");var j=DiagramUtils.createGraph(k.xml,e[0],null,pageId);j.refresh();canvasDoneFn=function(i,n,l,m){$promise=$.ajax(createRequestPayload(b,d,c,a,i,n,l,m,null,null));$promise.done(function(o){DiagramUtils.aspectRegistry[a].resolve(o)});$promise.fail(function(o){DiagramUtils.aspectRegistry[a].reject(o.responseText)});$promise.always(function(o){delete DiagramUtils.aspectRegistry[a]})};nonCanvasDoneFn=function(n,l,o,p,i,m){$promise=$.ajax(createRequestPayload(b,d,c,a,mxUtils.getXml(i),null,m,o));$promise.done(function(q){DiagramUtils.aspectRegistry[a].resolve(q)});$promise.fail(function(q){DiagramUtils.aspectRegistry[a].reject(q.responseText)});$promise.always(function(q){delete DiagramUtils.aspectRegistry[a]})};createRequestPayload=function(l,p,n,i,m,r,o,q){q=q|1;payload={};payload.imageXml=m;payload.imageData=r;payload.imageWidth=Math.ceil(o.getGraphBounds().width*q)+2;payload.imageHeight=Math.ceil(o.getGraphBounds().width*q)+2;payload.aspect=i;payload.revision=n;payload.imageBackground="#ffffff";return{type:"POST",url:DiagramUtils.serviceEndpoint+"/aspect/"+l+"/"+encodeURIComponent(p)+"/",data:JSON.stringify(payload),dataType:"json",contentType:"application/json; charset=utf-8",}};EditorUi.prototype.updateActionStates=function(){};EditorUi.prototype.addBeforeUnloadListener=function(){};EditorUi.prototype.addChromelessClickHandler=function(){};var h=new EditorUi(new Editor(true),document.createElement("div"),true);h.refresh=function(){};h.editor.graph=j;model=j.model;var f=model.getChildCount(model.root);if(layerIds!=null&&layerIds.length>0){for(var g=0;g<f;g++){layer=model.getChildAt(model.root,g);visible=layerIds.indexOf(layer.id)!=-1;model.setVisible(layer,visible)}}mxUtils.imageExport(h,"png",nonCanvasDoneFn,canvasDoneFn,true,"auto",false,(j.model.background!=null&&j.model.background!="none"?j.model.background:"#ffffff"),null)}).fail(function(){DiagramUtils.aspectRegistry[a].reject("Could not load diagram while generating aspect preview")});return $createAspectD.promise()},updateAspectPreviews:function(a,c,b){$updateD=$.Deferred();$.ajax({type:"GET",url:BaseAtlasClient.prototype.getDrawioAspectUrl(c,a),dataType:"json"}).done(function(e){$createPs=[];for(var d in e){$createP=DiagramUtils.createAspectPreview(a,c,b,e[d]);$createPs.push($createP)}$.when.apply($,$createPs).done(function(){$updateD.resolve()}).fail(function(){$updateD.reject()})}).fail(function(d){$updateD.reject(d)});return $updateD.promise()},loadDiagram:function(a,c,b){b=b!=null?"?revision="+b:"";return $.ajax({type:"GET",url:DiagramUtils.serviceEndpoint+"/diagram/crud/"+c+"/"+a+b,dataType:"json"})},createGraph:function(f,b,a,c){var d=mxUtils.parseXml(f);var e=d.documentElement;if(e.nodeName=="mxfile"){diagramNode=a!=null?d.getElementsByTagName("diagram")[a]:d.querySelector('[id="'+c+'"]');f=diagramNode!=null?Graph.prototype.decompress(diagramNode.textContent):"";d=mxUtils.parseXml(f);e=d.documentElement}graphModel=DiagramUtils.createGraphModel(d);d=Graph.prototype.defaultThemes[Graph.prototype.defaultThemeName];var g=new mxCodec(d.ownerDocument);return new Graph(b,graphModel,null,g.decode(d))},createGraphModel:function(a){var c=new mxGraphModel();var b=new mxCodec(a);b.decode(a.documentElement,c);return c}};
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.mxgraph.confluence.plugins.diagramly:drawio-rte', location = 'js/mxImageExport.js' */
mxUtils.imageExportDataURI=function(c,q,k,t,s,m,j){m=(m!=null)?m:true;j=(j!=null)?j:true;t=(t!=null)?t:1;s=(s!=null)?s:1;var a=new mxImageExport();var i=a.drawCellState;a.drawCellState=function(u,b){if(m||u.view.graph.isCellSelected(u.cell)){i.apply(this,arguments)}};var e=(m||j)?c.getGraphBounds():c.getBoundingBox(c.getSelectionCells());var o=c.view.scale;var h=mxUtils.createXmlDocument();var n=h.createElement("output");h.appendChild(n);var p=new mxXmlCanvas2D(n);p.translate(Math.floor((s/t-e.x)/o),Math.floor((s/t-e.y)/o));p.scale(t/o);var f=1;var d=new Object();function g(b){f--;if(f==0){if(q!="pdf"){var v=n.getElementsByTagName("text");for(var u=0;u<v.length;u++){if(v[u].attributes.format=="html"){var w=v[u].attributes.str;w.nodeValue=mxUtils.replaceHyphens((w.nodeValue))}}}k(q,e,t,o,n,c)}}function r(b){f++;b()}var l=p.image;p.image=function(F,E,G,B,b,u,C,v){if(b.substring(5)==="data:"){return b}else{b=this.converter.convert(b);var D=document.createElement("a");D.href=b;D.href=D.href;if(location.hostname!=D.hostname){l.apply(this,arguments);return}var z=this.createElement("image");z.setAttribute("x",this.format(F));z.setAttribute("y",this.format(E));z.setAttribute("w",this.format(G));z.setAttribute("h",this.format(B));z.setAttribute("src",b);z.setAttribute("aspect",(u)?"1":"0");z.setAttribute("flipH",(C)?"1":"0");z.setAttribute("flipV",(v)?"1":"0");this.root.appendChild(z);var A=d[b];if(A!="error"){if(A instanceof Array){A.push(function(w){z.setAttribute("src",w)})}else{if(A instanceof String){z.setAttribute("src",A)}else{if(A==null){d[b]=[function(w){z.setAttribute("src",w)}];r(function(){try{var x=new mxXmlRequest(b,null,"GET");x.setBinary(true);x.send(function(L){var M=null;if(mxClient.IS_IE){var J=mxUtilsBinaryToArray(L.request.responseBody).toArray();var I=new Array(J.length);for(var H=0;H<J.length;H++){I[H]=String.fromCharCode(J[H])}}else{var J=L.getText();var I=new Array(J.length);for(var H=0;H<J.length;H++){I[H]=String.fromCharCode(J.charCodeAt(H)&255)}}M=I.join("");if(M!=null&&M.length>0){var K=b.substring(b.lastIndexOf(".")+1,b.length);var y=K.toLowerCase()=="svg"?"svg+xml":K.toLowerCase();A="data:image/"+y+";base64,"+(window.btoa?btoa(M):Base64.encode(M,true));for(var H=0;H<d[b].length;H++){d[b][H](A)}d[b]=A}else{d[b]="error"}g()},function(y){d[b]="error";g()})}catch(w){d[b]="error";g()}})}}}}}};a.drawState(c.getView().getState(c.model.root),p);g(true)};mxUtils.replaceHyphens=function(a){return a.replace(/(-)(?![^<]*>|[^<>]*<\/)/gi,"&#8208")};mxUtils.imageExport=function(o,n,c,m,i,d,e,g,b){i=(i!=null)?i:true;var f=null;if(n=="png"){f="image/png"}else{if(n=="jpeg"||n=="jpg"){f="image/jpeg"}}var p=o.editor.graph;if(!i&&o.pages!=null&&o.currentPage!=o.pages[0]){p=o.createTemporaryGraph(p.getStylesheet());var l=p.getGlobalVariable;var j=i?o.currentPage:o.pages[0];document.body.appendChild(p.container);if(j.root==null){o.updatePageRoot(j)}p.model.setRoot(j.root)}if(d=="auto"){var a=p.getGraphBounds();var k=8000;var d=2;if(a.width<mxConstants.PAGE_FORMAT_A4_LANDSCAPE.width/4){d=3}else{if(a.width>k||a.height>k){d=Math.min(1,Math.min(k/a.width,k/a.height))}else{if(a.width>mxConstants.PAGE_FORMAT_A4_LANDSCAPE.width){d=1}}}}var h=mxUtils.bind(this,function(){if(b!=null){var u=o.getFileData(true,null,null,null,null,i);var t=p.getGraphBounds();var q=Math.floor(t.width*d/p.view.scale);var r=Math.floor(t.height*d/p.view.scale);var s=new mxXmlRequest(b,"format="+n+"&base64=1&bg="+((g!=null)?g:"none")+"&w="+q+"&h="+r+"&border="+e+"&xml="+encodeURIComponent(u));try{s.send(mxUtils.bind(this,function(w){if(w.getStatus()>=200&&w.getStatus()<=299){m(null,w.getText(),p,d)}else{mxUtils.imageExportDataURI(p,n,c,d,e)}}),mxUtils.bind(this,function(){mxUtils.imageExportDataURI(p,n,c,d,e)}))}catch(v){mxUtils.imageExportDataURI(p,n,c,d,e)}}else{mxUtils.imageExportDataURI(p,n,c,d,e)}});if(this.imageCache==null){this.imageCache={}}if(n!="pdf"&&o.isExportToCanvas()){o.exportToCanvas(mxUtils.bind(this,function(q){try{var s=q.toDataURL(f);m(null,s.substring(s.lastIndexOf(",")+1),p)}catch(r){h()}}),null,this.imageCache,g,mxUtils.bind(this,function(q){h()}),false,null,d,g==null,null,null,p,e)}else{h()}if(p!=o.editor.graph){p.container.parentNode.removeChild(p.container)}};
}catch(e){WRMCB(e)};