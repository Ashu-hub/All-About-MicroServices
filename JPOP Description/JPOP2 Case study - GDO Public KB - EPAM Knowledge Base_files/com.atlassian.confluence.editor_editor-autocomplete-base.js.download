WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-base', location = 'tinymce3/plugins/autocomplete/autocomplete-settings.js' */
define("confluence-editor/tinymce3/plugins/autocomplete/autocomplete-settings",["ajs"],function(b){return{Settings:{},log:function(d){return function(e,f,a){var c=null!=a&&"object"!==typeof a;b.debug(d+" - "+e+" : "+(f||null)+(null!=a?c?" = "+a:" >":""));a&&!c&&b.debug(a)}}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor/tinymce3/plugins/autocomplete/autocomplete-settings","Confluence.Editor.Autocompleter");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-base', location = 'tinymce3/plugins/autocomplete/autocomplete-util.js' */
define("confluence-editor/tinymce3/plugins/autocomplete/autocomplete-util",["ajs","jquery"],function(f,k){var h=function(a,c,g,b,d){var e;a.statusMessage?e=[[{html:a.statusMessage,className:"error"}]]:(a=c?f.REST.makeRestMatrixFromSearchData(a):f.REST.makeRestMatrixFromData(a,b),e=f.REST.convertFromRest(a));g(e,c,function(a,b){d&&typeof d==="function"&&d(e,a,b)})};return{dropdownLink:function(a,c,g){return"<a href='#' class='"+(c||"")+"'><span class='icon "+(g||"")+"'></span><span>"+a+"</span></a>"},
getRestData:function(a,c,g,b,d,e,f){var i=c(b),j=a.settings.cacheManager,c=j.get(b);i?(a=k.ajax({type:"GET",url:i,data:g(a,b),dataType:"json",global:!1,timeout:5E3}),a.done(function(a){j.put(b,a)}),c?h(c,b,d,e,f):(a.done(function(a){h(a,b,d,e,f)}),a.fail(function(a,c){"timeout"==c&&h({statusMessage:"Timeout",query:b},b,d,e)}))):d([],b)}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor/tinymce3/plugins/autocomplete/autocomplete-util","Confluence.Editor.Autocompleter.Util");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-base', location = 'tinymce3/plugins/autocomplete/autocomplete-control.js' */
define("confluence-editor/tinymce3/plugins/autocomplete/autocomplete-control",["ajs","jquery","confluence/legacy","confluence-editor/tinymce3/plugins/autocomplete/autocomplete-settings","document"],function(c,h,s,z,A){var v=function(d,i){var f,a,j=z.log("Autocompleter.Control"),u=require("tinymce"),b={},p=d.selection,t=p.getRng(!0),q=t.startOffset,l=t.startContainer;a=l.nodeValue;var n=i.leadingChar,x=d.getDoc(),o=i.backWords||0,F=i.insertedFromMenu||!1,k=z.Settings[n||"["];f=!k||"undefined"===typeof k.preventStartNodes?
"div.code, a[href], img, pre":k.preventStartNodes;if(h("#autocomplete",x).length)return c.debug("init","Autocomplete already exists, returning null."),null;b.backWords=o;b.maxResults=i.maxResults||10;null==a&&(t.collapsed&&q&&l.childNodes[q-1])&&(l=l.childNodes[q-1],q=(a=l.nodeValue)&&a.length||0);var r="";if(null!=a)for(var r=(a+"").substring(0,q),m=l.previousSibling;m&&3===m.nodeType;)r=m.nodeValue+r,m=m.previousSibling;var m=[/([("'<\u201c\u2018]\[|[\ufeff\u200b\u2014\s\xa0].)$/,/(\([^!])$/,/(\/\/)$/],
g;if(g=!o)if(g=r){a:{r+=n;g=0;for(var G=m.length;g<G;g++)if(m[g].test(r)){m=!0;break a}m=!1}g=!m}if(g)return j("init","Cursor is in wrong word location to start autocomplete, returning null."),null;if(h(l).closest(f).length)return j("init","Cursor is in wrong node to start autocomplete, returning null."),null;s.PropertyPanel&&s.PropertyPanel.current&&(s.PropertyPanel.shouldCreate=!1,s.PropertyPanel.destroy());!n&&null==a&&(c.debug("init","No text available for suggestion, range is",t),a="");b.getContainer=
function(){return h("#autocomplete",x)};if(t.collapsed&&o&&a){f=l;a=q;m=function(b,e,c){!e.global&&(e=RegExp(e.source,"g"+"i".slice(0,e.ignoreCase)+"m".slice(0,e.multiLine)));c==null?c=b.length:c<0&&(c=0);for(var b=b.substring(0,c+1),c=-1,d=0,a;(a=e.exec(b))!=null;){c=a.index;e.lastIndex=++d}return c};for(r=0;r<o;r++){g=f.nodeValue.substring(0,a);for(a=m(g,/\s+/,a);-1==a;)if((g=f.previousSibling)&&3===g.nodeType)f=g,(g=g.nodeValue)&&(a=m(g,/\s+/,g.length));else{r=o;break}}a+=1;u.isIE&&1==o?(o=p.getRng(),
o.moveStart("character",a-q),o.select()):(o=p.getRng(!0),o.setStart(f,a),o.setEnd(l,q),p.setRng(o))}q=p&&p.getNode()&&p.getNode().classList.contains("placeholder-inline-tasks")?"":p.getContent({format:"text"}).replace("\n","");j("init","suggestionHtml",q);l=c("span").attr("id","autocomplete");i.classNames&&l.addClass(i.classNames);n&&l.append(c("span").attr("id","autocomplete-trigger").text(n));n=c("span").attr("id","autocomplete-search-text");n.text(c.Rte.HIDDEN_CHAR);l.append(n);p.setNode(l[0]);
var w=b.getContainer();b.previousSearchText="";b.settings=k;!1!==k.cache&&!k.cacheManager?k.cacheManager=new c.Confluence.localStorageCacheManager(k.ch):!1===k.cache&&!k.cacheManager&&(k.cacheManager={get:h.noop,put:h.noop});k=h("#autocomplete-search-text",b.getContainer());n=h(x.createElement("span")).text(q||c.Rte.HIDDEN_CHAR);k.empty().append(n);p.select(n[0],!0);p.collapse();var B=function(c,e){if(b.onBeforeKey&&!b.onBeforeKey(e,b.text())){u.dom.Event.cancel(e);j("before","blocked by onBeforeKey: "+
e.keyCode);return false}},C=function(c,e){var a=p.getRng(true),d=b.getContainer(),f=a.startContainer,a=f.parentNode;f.nodeType===3&&(a=a.parentNode);var g=(f=a?a.parentNode:null)?f.parentNode:null,d=a!==d[0]&&f!==d[0]&&g!==d[0];if(e.keyCode===27||d){j("after","dying because of: "+(d?"outside search span":"escape pressed"));b.die()}else if(b.onAfterKey&&!b.onAfterKey(e,b.text())){u.dom.Event.cancel(e);j("after","blocked by onAfterKey: "+e.keyCode);return false}},D=function(c,e){if(b.onKeyPress&&!b.onKeyPress(e,
b.text())){u.dom.Event.cancel(e);j("press","blocked by onKeyPress: "+e.keyCode);return false}},E=function(c,e){if(b.getContainer()[0]!=e.target.parentNode){j("click","Clicked outside of autocomplete, closing.");b.die()}};d.onKeyDown.addToTop(B);d.onKeyUp.addToTop(C);d.onKeyPress.addToTop(D);d.onClick.addToTop(E);b.word="";i.keepAlias?j("init","No suggestion based on previous or selected text"):b.word=q;c.Rte.showElement(w[0]);k=u.DOM.getPos(w[0]);n=w.height();b.left=k.x;b.top=k.y+n;b.text=function(a){var e=
h("#autocomplete-search-text",b.getContainer());if(a!=null){e.html(a);return this}a=c.escapeEntities(e.text());return a.replace(c.Rte.HIDDEN_CHAR,"")};b.plainText=function(a){var e=h("#autocomplete-search-text",b.getContainer());if(a!=null){e.text(a);return this}a=e.text();return a.replace(c.Rte.HIDDEN_CHAR,"")};var y=function(a,c){var d=b.getContainer();return v.replaceWithTextAndGetRange(d,a,c)};b.replaceWithSelectedSearchText=function(){var a=b.text();j("replaceWithSelectedSearchText",a);y(a,false);
return a};b.die=function(a){if(b.dying)c.debug("die","Already dying, returning.");else{b.dying=true;if(s.PropertyPanel)s.PropertyPanel.shouldCreate=true;if(b.getContainer().length){j("die","Tearing down autocomplete, cleaning up autocompleter");a=(a||i.backWords||F?"":b.settings.ch)+b.text();t=y(a,true)}setTimeout(function(){j("die","Removing autocomplete-control keyboard listeners.");d.onKeyDown.remove(B);d.onKeyUp.remove(C);d.onClick.remove(E);d.onKeyPress.remove(D)},1);c.Rte.unbindScroll("autocomplete");
h(A).unbind("click.autocomplete-outside");this.onDeath&&this.onDeath()}};c.Rte.bindScroll("autocomplete",function(a){c.debug("scrolling:",a);if(c.Rte.isAnyPartShown(w))b.onScroll();else b.die()});h(A).bind("click.autocomplete-outside",function(a){var c=a.srcElement&&a.srcElement.id==="rte-insert-date";!h(a.target).closest("#autocomplete-dropdown, .aui-datepicker-dialog, .ui-datepicker-header").length&&!c&&b.die()});c.Rte.getEditor().onBeforeExecCommand.add(function(a,c){c=="mceConfSavePage"&&b.die()});
b.update=function(a){c.Rte.BookmarkManager.storeBookmark();y("",true);this.settings.update(this,a)};b.removeSpan=function(){b.getContainer().remove()};return b};v.removeOrphanedControl=function(){var d=h(c.Rte.getEditor().getDoc()),i=d.find("#autocomplete"),f;if(!i.length)return null;f=d.find("#autocomplete-trigger").text();d=d.find("#autocomplete-search-text").text();v.replaceWithTextAndGetRange(i,d,!1);return{leadingChar:f,content:d}};v.replaceWithTextAndGetRange=function(d,i,f){if(d.length){var i=
i||"",f=f||!i,a=c.Rte.getEditor(),j=d[0].parentNode,h=c.Rte.Content.getChildIndex(j,d[0]),b=f?1:0,f=a.selection.getRng(!0);f.setStart(j,h+b);f.setEnd(j,h+1);d.before(i||c.Rte.HIDDEN_CHAR).remove();a.selection.setRng(f);return f}c.log("replaceWithTextAndGetRange Error: attempting to replace a non-existent element")};return v});require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor/tinymce3/plugins/autocomplete/autocomplete-control","Confluence.Editor.Autocompleter.Control");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-base', location = 'tinymce3/plugins/autocomplete/autocomplete-manager.js' */
define("confluence-editor/tinymce3/plugins/autocomplete/autocomplete-manager",["ajs","jquery","window","confluence-editor/tinymce3/plugins/autocomplete/autocomplete-settings","confluence-editor/tinymce3/plugins/autocomplete/autocomplete-control"],function(f,j,p,n,o){n.log("Autocompleter.Manager");var c,a,k=function(g){var d=n.Settings[g.leadingChar],g=j.extend({minLengthForGetData:d.minLengthForGetData,displayHandler:d.displayHandler,Highlighter:d.Highlighter,classNames:d.autocompleteClassNames},
g);c=o(f.Rte.getEditor(),g);if(!c)return!1;f.trigger("synchrony.stop",{id:"confluence.autocomplete-plugin"});var q=j(p).width(),h,k=function(b){var i=j("#autocomplete-dropdown"),e=c.getContainer(),a,g,d,k,m;i.length||(i=f("div").addClass("aui-dd-parent quick-nav-drop-down").attr("id","autocomplete-dropdown").appendTo("body"));a=f.Position.spaceAboveBelow(f.Rte.getEditorFrame(),e);b.find("ol:has(a.menu-header)").addClass("top-menu-item");b.find("ol:empty").hide();i.append(b);d=f.Rte.Content.offset(e);
k=Math.max(i.width()+d.left-q+10,0);g=d.left-k-0;b=b.outerHeight(!0);m=b+10;if(h){var l;l=1==h?a.above>=m:a.below>=m;l||(h=null)}h||(h=a.below>=m?2:a.above>=m?1:a.below>a.above?2:1);a=i.find(".autocomplete-dropdown-arrow");a.length||(a=j("<div>").addClass("autocomplete-dropdown-arrow").addClass(c.settings.autocompleteClassNames));1===h?(a.addClass("autocomplete-dropdown-bottom-arrow").css({top:b-1}),e=d.top-b-10):(a.removeClass("autocomplete-dropdown-bottom-arrow").css("top",""),e=d.top+e.height()+
10);a.css({left:k}).appendTo(i);i.css({position:"absolute",top:e,left:g})};a=f.inputDrivenDropdown({onShow:function(b){f.trigger("rte-autocomplete-on-show",{triggerChar:c.settings.ch});var a=f.Rte.getEditorFrame();a&&a.shim&&a.shim.hide();b.find("a.menu-header").unbind().click(function(b){b.preventDefault();c.die()});this.reset();c.settings.selectFirstItem&&b.find("a:not('.menu-header')").length&&f.dropDown.current.moveDown()},dropdownPlacement:k,onDeath:function(){j("#autocomplete-dropdown").remove()},
ajsDropDownOptions:{selectionHandler:function(b,a){b.preventDefault();var e=j.data(a[0],"properties");e&&"function"===typeof e.callback?e.callback(c):"menu-header"!==e.className&&c.update(e);c.die()},moveHandler:function(b,a){var c=f.dropDown.current;b&&b.find("a").is(".menu-header")&&("up"==a?c.moveUp():c.moveDown())},className:"autocomplete "+c.settings.dropDownClassName,displayHandler:g.displayHandler,Highlighter:g.Highlighter},getDataAndRunCallback:function(b){c&&c.settings.getDataAndRunCallback&&
c.settings.getDataAndRunCallback(c,b,function(i,e,d,g){i.unshift([{className:"menu-header dropdown-prevent-highlight",href:"#",name:c.settings.getHeaderText(c,b)}]);i.push(c.settings.getAdditionalLinks(c,b,d));a&&a.show(i,e,g||[e])})},dropDownDelay:c.settings.dropDownDelay,minLengthForGetData:c.settings.minLengthForGetData});c.onBeforeKey=function(b,a){var c=require("tinymce");return 40===b.keyCode||38===b.keyCode||13===b.keyCode?(c.dom.Event.cancel(b),!1):27===b.keyCode||9===b.keyCode||8===b.keyCode&&
!a?(this.die(8===b.keyCode),!1):!0};c.onKeyPress=function(b){var a=require("tinymce"),e=String.fromCharCode(j.browser.msie?b.keyCode:b.which);if(13===b.keyCode)return a.dom.Event.cancel(b),!1;-1!==f.indexOf(this.settings.endChars,e)&&c.die();return!0};var l=RegExp("\\S{"+(g.minLengthForGetData||2)+",}");c.onAfterKey=function(b,d){if(40===b.keyCode||38===b.keyCode||13===b.keyCode){var e=f.dropDown.current;if(!e)return!1;if(-1==e.getFocusIndex()&&13===b.keyCode)return c.die(),c=null,!0;b.which||(b.which=
b.keyCode);return e.moveFocus(b)}if(!(e=8===b.keyCode&&!d))e=/[\u4E00-\u9FFF]/gi.test(d);(e||l.test(d))&&a.change(d,e);return!0};c.onDeath=function(){a&&(a.remove(),a.closing=!0);f.trigger("synchrony.start",{id:"confluence.autocomplete-plugin"})};c.onScroll=function(){a.dd&&k(a.dd.$)};c.getCurrentItem=function(){if(!a||!a.dd)return null;var b=a.dd,c=b.getFocusIndex();return 0>c?null:j.data(b.links[c],"properties")};a.change(c.text(),"force");return!0},l={getInputDrivenDropdown:function(){return a},
triggerListener:function(c,d){var f=require("tinymce");if(d.metaKey)return!0;var h=j.browser.msie?d.keyCode:d.which;a&&a.closing&&(a=null);h=String.fromCharCode(h);!a&&h in n.Settings&&k({leadingChar:h})&&f.dom.Event.cancel(d);return!0},shortcutFired:function(g,d){var f=d?0:1;a&&a.closing&&(a=null);a&&(f=d?0:c.backWords+1,c.die(),c=null);return k({leadingChar:g,backWords:f})},reattach:function(){var a=o.removeOrphanedControl();a&&l.shortcutFired(a.leadingChar)}};return l});
require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor/tinymce3/plugins/autocomplete/autocomplete-manager","Confluence.Editor.Autocompleter.Manager");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-base', location = 'tinymce3/plugins/autocomplete/editor_plugin_src.js' */
define("confluence-editor/tinymce3/plugins/autocomplete/editor_plugin_src",["tinymce","confluence/legacy","ajs"],function(a,b,c){return{init:function(a){b.Editor.Autocompleter.Settings={};a.onPostRender.add(function(){c.debug("Autocomplete enabled, adding keyPress listener");a.onKeyPress.addToTop(b.Editor.Autocompleter.Manager.triggerListener);c.trigger("ready-editor-autocomplete")});a.onUndo.add(b.Editor.Autocompleter.Manager.reattach);a.onRedo.add(b.Editor.Autocompleter.Manager.reattach)},getInfo:function(){return{longname:"Auto Complete",
author:"Atlassian",authorurl:"http://www.atlassian.com",version:a.majorVersion+"."+a.minorVersion}}}});require("confluence/module-exporter").safeRequire("confluence-editor/tinymce3/plugins/autocomplete/editor_plugin_src",function(a){var b=require("tinymce");b.create("tinymce.plugins.AutoComplete",a);b.PluginManager.add("autocomplete",b.plugins.AutoComplete)});
}catch(e){WRMCB(e)};