WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.stiltsoft.confluence.plugin.tablefilter.tablefilter:editor-extensions~tf-editor-gen-res', location = 'build/editor-extensions~tf-editor.js' */
(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{16:function(e,t,a){"use strict";var r=a(10),i=a(0),n=a(13),l=a.n(n),o={contents:null,tfs:{},panels:[],init:function(){var e=this;$.ajax({contentType:"application/x-www-form-urlencoded; charset=utf-8",type:"GET",cache:!1,url:Confluence.getContextPath()+"/rest/table-filter/1.0/service/license",dataType:"json",success:function(t){t&&(e.initFilters(),e.bindEvents(),AJS.Rte.Content.editorResetContentChanged())}})},initFilters:function(){var e=this;e.contents=$("#wysiwygTextarea_ifr").contents(),e.toolbar=$("#rte-toolbar"),e.contents.find('[data-macro-name="table-filter"]').each((function(){e.createFilter($(this))}))},bindEvents:function(){var e=this,t=function(t){t.attributes&&t.attributes["data-macro-name"]&&"table-filter"===t.attributes["data-macro-name"].value?e.createFilter($(t)):t.querySelectorAll&&$(t.querySelectorAll('[data-macro-name="table-filter"]')).each((function(){e.createFilter($(this))}))};if(window.MutationObserver){new MutationObserver((function(e){e.forEach((function(e){Array.prototype.forEach.call(e.addedNodes,(function(e){t(e)}))}))})).observe(e.contents[0],{childList:!0,subtree:!0})}else e.contents.bind("DOMNodeInserted",(function(e){t(e.target)}));AJS.bind("created.property-panel",(function(t,a){if("macro"==a.type){var r=$(a.anchor);if("table-filter"==r.attr("data-macro-name")){var i=r.attr("id"),n=e.tfs[i];if(n&&n.tables.length)e.toolbar.find(".tablefilter-outer-wrapper").data("id")==i?a.panel.find(".macro-property-panel-show-tf").addClass("hide-tf").addClass("visible").find(".panel-button-text").text("Hide filter"):a.panel.find(".macro-property-panel-show-tf").removeClass("hide-tf").addClass("visible").find(".panel-button-text").text("Show filter");else a.panel.find(".macro-property-panel-show-tf").hide()}}})),$(document).bind("enableContextToolbarRow.Toolbar",(function(){$(o.toolbar.find(".tablefilter-outer-wrapper")).appendTo(o.toolbar)})),e.bindSave(),tinymce.activeEditor.onUndo.listeners?(tinymce.activeEditor.onUndo.listeners.push({cb:function(){e.updateFilters()}}),tinymce.activeEditor.onRedo.listeners.push({cb:function(){e.updateFilters()}})):(tinymce.activeEditor.onUndo.add((function(){e.updateFilters()})),tinymce.activeEditor.onRedo.add((function(){e.updateFilters()})));var a,n=function(e,t){var a=$("<div/>").append(t.content),n=a.find('table[data-macro-name="table-filter"], table[data-macro-name="pivot-table"], table[data-macro-name="table-chart"], table[data-macro-name="table-joiner"]').each((function(e){var t=$(this),a=Confluence.MacroParameterSerializer.deserialize(t.attr("data-macro-parameters"));a.id=(new Date).getTime()+e+"_"+i.a.hashCode(this.outerHTML),t.attr("id",a.id),t.attr("data-macro-parameters",Confluence.MacroParameterSerializer.serialize(a))}));if(r.a.prototype.tableWrapper=a.find(".tablefilter-table-wrapper"),r.a.prototype.tables=r.a.prototype.tableWrapper.find("table"),r.a.prototype.editorMacro=!0,r.a.prototype.makeTablesScrollable(),0===n.length){var l=a.find("table.tf-copy-table");l.length&&(l.removeClass("tf-copy-table"),l.find("tr").filter((function(){return!i.a.isRowVisible(this)})).remove(),l.find(".fake").removeClass("fake").filter((function(){return"none"===this.style.display})).remove(),l.find(".tf-hidden-column, .tf-header-hidden").remove(),l.find('[class*="tf-rowspan-"]').each((function(){var e=$(this);e.removeClass(e.getClassStartsWith(/tf-rowspan-\d+/))})),l.find('[class*="tf-colspan-"]').each((function(){var e=$(this);e.removeClass(e.getClassStartsWith(/tf-colspan-\d+/))})))}t.content=a.html()},l=function(){clearTimeout(a),a=setTimeout((function(){$.each(e.tfs,(function(t,a){if(0==a.tableWrapper.closest("body").length){var r=e.contents.find('[id="'+t+'"]');r.length&&(r.attr("id",""),e.panels[t]&&(e.panels[t].remove(),e.panels[t]=null),e.createFilter(r))}}))}),100)},s=tinymce.activeEditor.plugins.confluencepaste||tinymce.activeEditor.plugins.aePaste;s.onPreProcess?(s.onPreProcess.listeners.push({cb:n}),s.onPostProcess.listeners.push({cb:l})):(tinymce.activeEditor.on("PastePreProcess",(function(e){n(tinymce.activeEditor,e)})),tinymce.activeEditor.on("PastePostProcess",l)),$("#content-title").bind("focus click",(function(){e.toolbar.find(".tablefilter-outer-wrapper .disabled").removeClass("disabled").removeAttr("disabled"),e.toolbar.find(".tablefilter-outer-wrapper .lockEnabled").find(".filter-reset, .filter-settings").attr("disabled","disabled")})),e.contents.click((function(){e.toolbar.find(".tablefilter-outer-wrapper .lockEnabled").find(".filter-reset, .filter-settings").attr("disabled","disabled")})),e.toolbar.delegate(".tablefilter-outer-wrapper .aui-buttons.close","click",(function(){var e=o.toolbar.find(".tablefilter-outer-wrapper"),t=e.data("id");e.hide(),$("body").append(e),$("#inline-dialog-tf-add-filter-"+t).hide(),"false"==$("#filter-menu-view-"+t+"-"+AJS.params.pageId).attr("aria-hidden")&&$("#filter-settings-"+t).trigger("aui-button-invoke")})),e.toolbar.delegate(".aui-iconfont-remove-row","mousedown",(function(){var e=$(tinymce.activeEditor.selection.getNode());e.is("td,th")&&(e=e.parent()),e.children('[rowspan="-1"]').attr("rowspan","1")}))},bindSave:function(){var e=this;setTimeout((function(){!Confluence.Editor.UI.isButtonEnabled||Confluence.Editor.UI.isButtonEnabled(Confluence.Editor.UI.saveButton)?(AJS.Editor.addSaveHandler((function(){e.destroyFilters()})),AJS.bind("rte-changeMode",(function(t,a){a==Confluence.Editor.MODE_PREVIEW?e.destroyFilters():a==Confluence.Editor.MODE_RICHTEXT&&($(".tablefilter-outer-wrapper").remove(),e.initFilters())}))):e.bindSave()}),200)},createFilter:function(e){var t=o,a=Confluence.MacroParameterSerializer.deserialize(e.attr("data-macro-parameters"));if(e.data("tf-init")||0!==e.find('[data-macro-name="pivot-table"],[data-macro-name="table-joiner"],[data-macro-name="table-filter"]').length)t.tfs[a.id]&&(t.tfs[a.id].tables.trigger("destroy"),t.makeTablesSortable(t.tfs[a.id]));else{if(t.contents.find('[id="'+a.id+'"]').length>1)return;if(e.data("tf-init",!0),e.attr("id",a.id),e.find(".wysiwyg-macro-body:eq(0)").addClass("tablefilter-table-wrapper"),t.panels[a.id])return t.tfs[a.id].tableWrapper=e.find(".tablefilter-table-wrapper"),t.tfs[a.id].getTable(),t.tfs[a.id].normalizeTable(),t.tfs[a.id].addNumbering(),t.tfs[a.id].appendSparklines(),t.tfs[a.id].bindDOMChange(),t.tfs[a.id].makeTablesScrollable(),t.tfs[a.id].filterTable(),t.tfs[a.id].tables.trigger("destroy"),t.tfs[a.id].editorMacro=e,t.makeTablesSortable(t.tfs[a.id]),void t.bindSynchronyFiltration(e,t.tfs[a.id]);var i=a["cell-width"]?a["cell-width"].split(","):[],n=a.default?a.default.split(","):[],s=a.inverse?a.inverse.split(","):[],d=a.labels?a.labels.split("‚"):[],c=0,f=0,b=0,p=null!=a.column?a.column.split(","):[],u=t.getFilterObjects(p,d,n,i,s,c,f,b);c+=p.length,f+=p.length,b+=p.length,p=null!=a.userfilter?a.userfilter.split(","):[];var h=t.getFilterObjects(p,d,n,i,s,c,f,b);c+=p.length,f+=p.length,b+=p.length,p=null!=a.numberfilter?a.numberfilter.split(","):[];var m=t.getFilterObjects(p,d,n,i,s,c,-1,b);c+=p.length,b+=p.length,p=null!=a.datefilter?a.datefilter.split(","):[];var g=t.getFilterObjects(p,d,n,i,s,c,-1,b);c+=p.length,b+=p.length;var v=(p="true"==a.globalFilter?["Global filter"]:[]).length?t.getFilterObjects(p,d,n,i,s,c,f,b)[0]:null;c+=p.length,f+=p.length,b+=p.length;var y=(p="true"==a.hideColumns?["Hide columns"]:[]).length?t.getFilterObjects(p,d,n,i,s,c,f,b)[0]:null;c+=p.length,f+=p.length,b+=p.length,p=null!=a.iconfilter?a.iconfilter.split(","):[];var w=t.getFilterObjects(p,d,n,i,s,c,f,b),F=$(l.a.panel({macroId:a.id,pageId:AJS.params.pageId,comboBoxes:u,edits:h,numberFilters:m,dateFilters:g,globalFilter:v,hideColumns:y,iconFilters:w,showNRows:a.showNRows,hideLabels:a.hidelabels,disableSave:a.disableSave,hideControls:a.hideControls,hidePane:!1,fd:!1,editable:!0,isEditor:!0}));F.addClass("toolbar-contextual"),F.append(l.a.editorCloseButton()),t.panels[a.id]=F,$("body").append(F);var S=$.extend(!0,{},a);S.macroParams=a,S.showNRows=S.showNRows||"all",S.heightValue=S.heightValue||"",S.numbering=S.numbering||"",S.sorts=a.sort?$.map(a.sort.split(","),(function(e){return e.replace(/\‚/g,",")})):[],S.separator=S.separator?S.separator.replace("Point (.)",".").replace("Comma (,)",","):".",S.pageId=AJS.params.pageId,S.sparkline="true"==S.sparkline,S.sparkName=S.sparkName||"",S.isLockEnabled=!0,S.thousandSeparator=(a.thousandSeparator||"").replace("\\u0020"," "),S.tabs=!1,S.editorMacro=e,t.tfs[a.id]=new r.a(S),t.tfs[a.id].showTable(!0),t.makeTablesSortable(t.tfs[a.id]),F.hide();var C=o.toolbar.find(".tablefilter-outer-wrapper");C.length>0&&0===t.tfs[C.data("id")].tableWrapper.parents("body").length&&(C.remove(),F.show(),F.find(".enableLock:visible").click(),o.toolbar.append(F)),t.bindSynchronyFiltration(e,t.tfs[a.id])}},bindSynchronyFiltration:function(e,t){e.attr("type")?(t.isLockEnabled=!1,t.setFilters(JSON.parse(e.attr("type")))):t.showOrHideTables(),window.MutationObserver&&new MutationObserver((function(){e.data("tf-self")?e.data("tf-self",!1):(t.isLockEnabled=!1,t.setFilters(JSON.parse(e.attr("type"))))})).observe(e[0],{attributes:!0,attributeOldValue:!0,attributeFilter:["type"]})},makeTablesSortable:function(e){e.sorting=!0,e.setMutationObserver(!0),e.tables.tablesorterEditor({cancelSelection:!1,dateFormat:e.dateFormat,locale:e.localeDateFormat,textExtraction:function(e){return i.a.getEditorCellText($(e))}}),e.sorting=!1,e.setMutationObserver(!0)},destroyFilters:function(){var e=this;$.each(e.tfs,(function(t,a){e.destroyFilter(a),e.cleanMacro(t),e.removePanel(t)})),e.tfs={}},cleanMacro:function(e){return this.contents.find('[id="'+e+'"]').data("tf-init",!1).attr("id","")},removePanel:function(e){this.panels[e]&&(this.panels[e].remove(),this.panels[e]=null)},destroyFilter:function(e){e.numbering="",e.fixedRows=0,e.editorSave=!0,e.showTableWithoutFilters(),e.addNumbering(),e.makeTablesScrollable(),e.tables.find(".fake").remove(),e.tables.trigger("destroy"),e.tables.find(".tablesorter-header").removeClass("tablesorter-header"),e.tables.find(".pivot-header").removeClass("pivot-header"),e.tables.find('[data-mce-style="display: none;"]').removeAttr("data-mce-style"),e.tables.find(".tf-sparkline-header, .tf-sparkline-container, .total-row, .total-col, .tf-header-hidden").remove(),e.tables.each((function(){$(this).data("fixed-header",!1)}))},updateFilters:function(){var e=this;$.each(e.tfs,(function(t,a){if(a.editorMacro.parent().length)a.tables.trigger("destroy"),e.makeTablesSortable(a),a.bindDOMChange();else{var r=e.cleanMacro(t);e.removePanel(t),e.createFilter(r)}}))},getFilterObjects:function(e,t,a,r,i,n,l,o){var s=[];return $.each(e,(function(e,d){var c=n+e,f=a.length>c?a[c].replace(/\‚/g,",").trim():"",b=f?f.replace(new RegExp("-Empty-","g"),"").split("&&"):[],p=f.split("->");s.push({label:t.length>o+e&&t[o+e]||d,name:d,defaultValue:f,columnWidth:l>-1&&r.length>l+e&&r[l+e]||"150",options:b,defaultFromValue:p[0],defaultToValue:p.length>1?p[1]:"",inverse:i.length>c&&"true"==i[c]})})),s}};t.a=o}}]);
}catch(e){WRMCB(e)};