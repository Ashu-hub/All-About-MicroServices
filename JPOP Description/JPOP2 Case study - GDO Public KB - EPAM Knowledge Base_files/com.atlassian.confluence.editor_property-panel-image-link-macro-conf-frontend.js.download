WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.editor:property-panel-image-link-macro-conf-frontend', location = 'tinymce3/plugins/imagedialog/editor_plugin_src.js' */
define("confluence-editor/tinymce3/plugins/imagedialog/editor_plugin_src",["tinymce","confluence/legacy"],function(a,b){return{init:function(a){a.onInit.add(function(){a.addCommand("mceConfimage",b.Editor.defaultInsertImageDialog)})},getInfo:function(){return{longname:"Confluence Image Dialog",author:"Atlassian",authorurl:"http://www.atlassian.com",version:a.majorVersion+"."+a.minorVersion}}}});
require("confluence/module-exporter").safeRequire("confluence-editor/tinymce3/plugins/imagedialog/editor_plugin_src",function(a){var b=require("tinymce");b.create("tinymce.plugins.ConfluenceImageDialog",a);b.PluginManager.add("confluenceimagedialog",b.plugins.ConfluenceImageDialog)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.editor:property-panel-image-link-macro-conf-frontend', location = 'utils/tinymce-image-utils.js' */
define("confluence-editor/utils/tinymce-image-utils","jquery confluence/api/logger confluence/meta ajs tinymce confluence/api/constants".split(" "),function(d,m,n,j,o,r){var p=["imagetext","src","align","border","width","height"],s=/\/download\/(thumbnails|attachments)\/([0-9]+)\//,q=function(a,b,f,c,e){if(c){a.width=b>=e?e:b;a.style.maxWidth=""}else{a.height=f>=e?e:f;a.style.maxHeight=""}},k;k={isScaledByWidth:function(){return false},updateImageElement:function(a,b){var f=d(a),c;c=b.destination;
c=k.isRemoteImg(c)?c:b.thumbnail?c.replace("/attachments/","/thumbnails/"):c.replace("/thumbnails/","/attachments/");b.src=c;f.toggleClass("confluence-content-image-border",!!b.border);f.toggleClass("confluence-thumbnail",!!b.thumbnail);c=0;for(var e=p.length;c<e;c++){var h=p[c],g=b[h];g!==false&&g!=null?f.attr(h,g):f.removeAttr(h)}o.activeEditor.undoManager.add()},insertFromProperties:function(a,b){d.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:r.CONTEXT_PATH+"/rest/tinymce/1/embed/placeholder/image",
data:d.toJSON(a),dataType:"text",success:function(a){k.insertImagePlaceholder(a,b)}})},insertImagePlaceholder:function(a,b){var f,c=k.isScaledByWidth(),e=d(a);f=c?j.Confluence.PropertyPanel.Image.getPresetImageSize("large"):n.get("content-type")==="comment"?j.Confluence.PropertyPanel.Image.getPresetImageSize("small"):j.Confluence.PropertyPanel.Image.getPresetImageSize("medium");e.css(c?"max-width":"max-height",f+"px");var h=o.activeEditor,g="_"+ +new Date,i=d("<div></div>").append(e.attr("id",g));
h.selection.setContent(i.html());var l=h.dom.get(g);h.dom.setAttrib(l,"id","");if(!e.hasClass("confluence-external-resource")){g=e.attr("data-image-width");i=e.attr("data-image-height");if(g===void 0&&i===void 0){g=e.attr("width");i=e.attr("height")}q(l,g,i,c,f);this.updateThumbnailAttribute(l)}d(l).one("load",function(){e.hasClass("confluence-external-resource")&&q(this,this.width,this.height,c,f);j.Rte.showSelection(function(){b||j.trigger("trigger.property-panel",{elem:l});h.undoManager.add()});
h.onChange.dispatch()})},updateThumbnailAttribute:function(a){var b=a.width,f=a.height;if(b||f){var c=d(a),e=c.attr("data-image-width"),h=c.attr("data-image-height"),g=n.get("max-thumb-width"),i=n.get("max-thumb-height"),a=!this.isRemoteImg(a.src)&&this.isThumbnailUsable(b,f,e,h,g,i);c.attr("thumbnail",a);c.toggleClass("confluence-thumbnail",a)}},isRemoteImg:function(a){var b=j.Rte.getCurrentBaseUrl();return a.match("(https?://)")&&a.indexOf(b)===-1},isThumbnailUsable:function(a,b,f,c,e,d){if(a){if(a>
e)return false;if(f===void 0&&c===void 0)return true;e=f/c;return e>=1?true:e*d>=a}a=b;if(a>d)return false;if(f===void 0&&c===void 0)return true;d=c/f;return d>=1?true:d*e>=a}};return{ImageProperties:function(a){if(a&&d.nodeName(a,"img")&&d(a).hasClass("confluence-embedded-image")){var b=d(a),a={destination:b.attr("src"),url:b.attr("src"),border:b.attr("class")&&b.attr("class").indexOf("confluence-content-image-border")!==-1?1:0,width:b.prop("width"),height:b.prop("height"),originalSelected:!b.attr("width")&&
!b.attr("height")};if(!k.isRemoteImg(a.destination)&&!d(b).hasClass("confluence-external-resource")){var f=a;var b=d(b).attr("src"),c=b.match(s);if(c&&c.length===3)b=c[2];else{m.log("ERROR: could not parse page id from image url "+b);b="0"}f.pageId=b}return d.extend({},a)}if(a.destination){a.imageFileName=a.imageFileName||a.destination;return d.extend({},a)}return null},ImageUtils:k}});
require("confluence/module-exporter").safeRequire("confluence-editor/utils/tinymce-image-utils",function(d){var m=require("tinymce");m.confluence.ImageProperties=d.ImageProperties;m.confluence.ImageUtils=d.ImageUtils});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.editor:property-panel-image-link-macro-conf-frontend', location = 'tinymce3/plugins/propertypanel/js/property-panel-links.js' */
define("confluence-editor/tinymce3/plugins/propertypanel/js/property-panel-links",["ajs","jquery","confluence/legacy","tinymce","window"],function(a,e,i,j,k){var h=0;return{name:"link",canHandleElement:function(a){return a.is("a")&&"#"!=a.attr("href")&&!a.hasClass("unresolved")},handle:function(f){var c=f.containerEl,g=f.ed,b=function(c){return a.Rte.getEditor().getLang(c)},f={anchorIframe:a.Rte.getEditorFrame()},d=0===(c.getAttribute("href")||"").indexOf("#"),b=[{className:"link-property-panel-goto-button",
text:b("propertypanel.links_goto"),tooltip:d?b("propertypanel.links_goto_disabled_tooltip"):c.href,href:c.href,disabled:d,click:function(){a.Confluence.PropertyPanel.destroy();var b=k.open(c.href,j.isIE?"_blank":"confluence-goto-link-"+a.params.pageId+"-"+h);b&&b.focus()}},{className:"link-property-panel-edit-button",text:b("propertypanel.links_edit"),tooltip:b("propertypanel.links_edit_tooltip"),disabled:e(c).hasClass("createlink")||!c.href,click:function(){a.Confluence.PropertyPanel.destroy();g.selection.select(c);
i.Editor.LinkBrowser.open()}},{className:"link-property-panel-unlink-button",text:b("propertypanel.links_unlink"),tooltip:b("propertypanel.links_unlink_tooltip"),click:function(){a.Confluence.PropertyPanel.destroy();g.execCommand("mceConfUnlink",!1,c);g.focus()}}],d=[];a.trigger("link-property-panel-buttons.created",{buttons:d,link:c});b=b.concat(d);a.Confluence.PropertyPanel.createFromButtonModel(this.name,c,b,f);h++}}});
require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor/tinymce3/plugins/propertypanel/js/property-panel-links","AJS.Confluence.PropertyPanel.Link",function(a){var e=require("ajs");e.bind("init.rte",function(){e.trigger("add-handler.property-panel",a)})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.editor:property-panel-image-link-macro-conf-frontend', location = 'tinymce3/plugins/propertypanel/js/property-panel-macros.js' */
define("confluence-editor/tinymce3/plugins/propertypanel/js/property-panel-macros","ajs tinymce jquery confluence/legacy document confluence/macro-js-overrides underscore".split(" "),function(b,m,d,s,n,t,u){var o=[],p=[],l={},k="__PROPERTY_PANEL_SPACER",v=[{key:k}];return{name:"macro",registeredEvents:o,canHandleElement:function(a){return a.hasClass("editor-inline-macro")||a.hasClass("wysiwyg-macro")},handle:function(a){function i(){var c="macro-placeholder-property-panel-remove-button";e.length>
0&&e[e.length-1].key==k&&(c=c+" first");h.push({className:c,text:"Remove",click:function(){b.Confluence.PropertyPanel.destroy();b.Rte.getEditor().execCommand("mceConfRemoveMacro",j)}});if(g.attr("data-macro-parameters")){var a=s.MacroParameterSerializer.deserialize(g.attr("data-macro-parameters"));if("atlassian-macro-output-type"in a){c=function(c){return function(b){a["atlassian-macro-output-type"]=c;g.attr("data-macro-parameters",s.MacroParameterSerializer.serialize(a));
c=="INLINE"?d(".macro-placeholder-property-panel-display-newline-button").removeClass("active"):d(".macro-placeholder-property-panel-display-inline-button").removeClass("active");d(b).addClass("active")}};h.push(null);h.push({className:"macro-placeholder-property-panel-display-newline-button",tooltip:"Display on new line",selected:a["atlassian-macro-output-type"]=="BLOCK",click:c("BLOCK")});h.push({className:"macro-placeholder-property-panel-display-inline-button",
tooltip:"Display inline",selected:a["atlassian-macro-output-type"]=="INLINE",click:c("INLINE")})}}d.each(o,function(){(!this.macroName||this.macroName==f)&&d(n).bind(q(this.id,this.macroName),this.handler)});c=p;f&&l[f]&&(c=c.concat(l[f]));d.each(c,function(){try{this(j,h,w)}catch(c){b.debug("Property panel init handler failed for : "+f+".  Is global handler : "+(d.inArray(this,p)>-1),c)}});if(h.length>0){var c=b.Confluence.PropertyPanel.createFromButtonModel("macro",
j,h,w),x=t.getFunction(f,"propertyPanelIFrameInjector");x&&x(c)}}if(!(a.e.type!=="click"&&a.e.type!=="mouseup")){var j=a.containerEl,g=d(j),f,e=[],a=!g.hasClass("editor-inline-macro"),y=!g.hasClass("wysiwyg-unknown-macro"),h=[],w={originalHeight:a&&g.height(),anchorIframe:b.Rte.getEditorFrame()},q=function(c,a){return c+"-button-click"+(a?a+".macro":"")+".property-panel"};if(y){var r=d.Deferred();f=g.attr("data-macro-name");if(b.MacroBrowser.getMacroMetadata(f))e=b.MacroBrowser.getMacroMetadata(f).buttons;
(a=t.getFunction(f,"getControls"))?a(function(a){var b=e,a=u.filter(a,function(a){return a.type==="button"}),a=u.map(a,function(a){return{key:a.key,label:a.name.value}});e=b.concat(v).concat(a).concat(v);r.resolve()}):r.resolve();r.done(function(){var a="macro-placeholder-property-panel-edit-button";e.length>0&&e[0].key==k&&(a=a+" last");h.push({className:a,text:"Edit",click:function(){b.Confluence.PropertyPanel.destroy();m.confluence.macrobrowser.editMacro(g)}});
d.each(e,function(a,c){if(c.key!=k){var i="macro-property-panel-"+c.key;a>0&&e[a-1].key==k&&(i=i+" first");a<e.length-1&&e[a+1].key==k&&(i=i+" last");h.push({className:i,text:c.label,parameterName:c.key,click:function(){d(n).trigger(q(c.key),g);d(n).trigger(q(c.key,f),g);b.Confluence.PropertyPanel.destroy()}})}})}).then(i())}else i()}},registerButtonHandler:function(a,b,d){Array.isArray(a)||(a=[a]);a.forEach(function(a){o.push({id:a,handler:b,macroName:d})})},registerInitHandler:function(a,b){if(b){l[b]=
l[b]||[];l[b].push(a)}else p.push(a)},yieldButtonFor:function(a,b){var j;d.each(a,function(){this.parameterName&&this.parameterName==b&&(j=this)});return j}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor/tinymce3/plugins/propertypanel/js/property-panel-macros","AJS.Confluence.PropertyPanel.Macro",function(b){var m=require("ajs");m.bind("init.rte",function(){m.trigger("add-handler.property-panel",b)})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.editor:property-panel-image-link-macro-conf-frontend', location = 'tinymce3/plugins/propertypanel/js/property-panel-images.js' */
define("confluence-editor/tinymce3/plugins/propertypanel/js/property-panel-images","jquery ajs tinymce confluence-editor/utils/tinymce-image-utils confluence/meta confluence/legacy confluence/api/browser confluence/property-panel".split(" "),function(f,g,s,F,v,w,G,h){function x(){var a=[];f.each(t,function(b,c){a.push(c)});h.current.panel.find(a.join(", ")).removeClass("active")}function p(a,b,c){var e=y(a,b),c=y(a,c),j=e||c;if(j){var d=h.getAnchor(),i=d.width(),d=d.height(),f=v.get("max-thumb-width"),
g=v.get("max-thumb-height");a.thumbnail=k.isRemoteImg(a.destination)?false:k.isThumbnailUsable(e,c,i,d,f,g);a.originalSelected=false;if(b){delete a.height;a.width=j}else{delete a.width;a.height=j}m(a);x();return true}return false}function z(a,b){if(u?p(a,n[b]):p(a,null,n[b])){A(b);m(a);return true}return false}function B(a){delete a.width;delete a.height;a.thumbnail=false;a.originalSelected=true;x();A("original");var b=h,c=b.getAnchor();b.current.updating=true;c.one("load",function(){l(b);q(a);a.width=
Math.floor(c.width());a.height=Math.floor(c.height())});k.updateImageElement(c,a);s.isGecko&&g.Rte.getEditor().execCommand("mceRepaint",false);c.each(function(){this.complete&&f(this).trigger("load")});return true}function A(a){h.current.panel.find(t[a]).addClass("active")}function C(a){f(".image-border-toggle").toggleClass("active",!a.border);a.border=+!a.border||false;m(a)}function m(a){var b=h,c=b.getAnchor(),e=c.attr("src"),f=c.height();b.current.updating=true;k.updateImageElement(c,a);s.isGecko&&
g.Rte.getEditor().execCommand("mceRepaint",false);if(a.src!=e){var d=setInterval(function(){var a=c.height();if(a!=f){g.debug("updateImageElement : height changed after image src change - "+f+" to "+a);clearTimeout(d);d=null;l(b)}},10);setTimeout(function(){if(d){clearTimeout(d);d=null;l(b)}},1E3)}else l(b);q(a)}function q(a){a=a.width?a.width:h.getAnchor().width();a=Math.floor(a);f("#image-size-input").val(a+"px")}function y(a,b){b=parseInt(b);if(!isNaN(b)){b<D?b=D:b>E&&(b=E);return b}return null}
var k=F.ImageUtils,u=k.isScaledByWidth(),n;n=u?{small:100,medium:300,large:500}:{small:150,medium:250,large:400};var t={small:".image-size-small",medium:".image-size-medium",large:".image-size-large",original:".image-size-original"},D=16,E=9E4,l=function(a){a.current.updating=false;a.current.snapToElement({animate:true,animateDuration:100})};return{_resizeImage:p,pluginButtons:[],name:"image",getPresetImageSize:function(a){return n[a]},canHandleElement:function(a){return a.is("img")&&!a.hasClass("editor-inline-macro")&&
!a.hasClass("template-variable")},handle:function(a){function b(){p(e,f("#image-size-input").val())?true:q(e);g.trigger("analyticsEvent",{name:"confluence.editor.image.resize.custom"})}var c;c=a.nodeName==="IMG"?a:a.containerEl;var a=f(c),e=s.confluence.ImageProperties(c);if(e&&!a.attr("data-resource-id")){var j=g.Rte.getEditor(),d=function(a){return j.getLang(a)},i=function(a){return{className:["image-size-"+a,"editor-resize","resize-"+a].join(" "),text:d("propertypanel.images_"+a),tooltip:d("propertypanel.images_"+
a+"_tooltip"),iconClass:"aui-icon aui-icon-small aui-iconfont-image-resize",click:function(){z(e,a);g.trigger("analyticsEvent",{name:"confluence.editor.image.resize."+a})},selected:u?e.width==n[a]:e.height==n[a]}},i=[{className:"editable",tooltip:d("propertypanel.images_sizing_tooltip"),html:'<input id="image-size-input"/>'},null,i("small"),i("medium"),i("large"),{className:"image-size-original",text:d("propertypanel.images_original"),tooltip:d("propertypanel.images_original_tooltip"),click:function(){B(e);
g.trigger("analyticsEvent",{name:"confluence.editor.image.resize.original"})},selected:e.originalSelected},null,{className:"image-border-toggle",text:d("propertypanel.images_border"),tooltip:d("propertypanel.images_border_tooltip"),click:function(){C(e)},selected:e.border||e.border==1}];i.push(null);var k=a.parent();if(k.is("a[href]")){i.push({className:"image-link-edit",text:d("propertypanel.images_link_edit"),tooltip:d("propertypanel.images_link_edit_tooltip"),click:function(){h.destroy();j.selection.select(k[0]);
w.Editor.LinkBrowser.open()}});i.push({className:"image-link-remove",text:d("propertypanel.images_link_remove"),tooltip:d("propertypanel.images_link_remove_tooltip"),click:function(){h.destroy();j.execCommand("mceConfUnlink",false,c);j.focus()}})}else i.push({className:"image-make-link",text:d("propertypanel.images_link_create"),tooltip:d("propertypanel.images_link_create_tooltip"),iconClass:"aui-icon aui-icon-small aui-iconfont-link",click:function(){h.destroy();j.selection.select(c);w.Editor.LinkBrowser.open()}});
for(var l=h.Image.pluginButtons,r=0;r<l.length;r++)if(l[r]===null)i.push(null);else{var m=l[r].create(a);m&&i.push(m)}h.createFromButtonModel(this.name,c,i,{anchorIframe:g.Rte.getEditorFrame()});a=f("#image-size-input");a.bind("focus",function(){f(this).select()});a.bind("change",function(){b()});(new G(window.navigator.userAgent)).isIE()&&a.bind("keyup",function(a){a.keyCode===13&&b()});h.current.imageProps=e;q(e);var o=e;return{setPresetSize:function(a){z(o,a)},setPixelSize:function(a){p(o,a)},
setToOriginalSize:function(){B(o)},toggleBorder:function(){C(o)},getWidth:function(){return o.width},getHeight:function(){return o.height},getDisplayWidth:function(){return f("#image-size-input").val()},isButtonSelected:function(a){return h.current.panel.find(t[a]).hasClass("active")}}}}}});
require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor/tinymce3/plugins/propertypanel/js/property-panel-images","AJS.Confluence.PropertyPanel.Image",function(f){var g=require("ajs");g.bind("init.rte",function(){g.trigger("add-handler.property-panel",f)})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.editor:property-panel-image-link-macro-conf-frontend', location = 'tinymce3/plugins/imageproperties/js/image-properties-dialog.js' */
define("confluence-editor/tinymce3/plugins/imageproperties/js/image-properties-dialog",["jquery","ajs"],function(d,a){function l(){h||(h=d("#image-properties-tab-items > div").map(function(){var a=d(this);return{key:a.text(),weight:a.attr("data-weight"),label:this.title}}).sort(function(a,b){return a.weight-b.weight}));return h}function m(){var a=c.popup.element,b=650/60,e=d('<div class="image-properties-loading-blanket"><div class="loading-data"></div></div>').appendTo(a.find(".dialog-page-body")),
f=e.find(".loading-data");e.css({width:e.parent().width(),height:a.height()});f.css({marginTop:-60,marginLeft:-60});f.spin({color:"#666",width:b,radius:25,length:25,top:0,left:0,zIndex:0,speed:1.042});var a=[],g;for(g in i)b=i[g],(b=b.saveFn&&b.saveFn())&&b.done&&a.push(b);d.when.apply(d,a).done(function(){var a=c.popup.element.find(".image-properties-loading-blanket .loading-data");a.css({marginTop:"",marginLeft:""});a.spinStop();a.closest(".image-properties-loading-blanket").remove();c.hide().remove()})}
function o(){c.hide().remove()}var c,h,i={},n;return{init:function(){n||(h=null,0<l().length&&(n=!0,a.Confluence.PropertyPanel.Image.pluginButtons.push(null,{create:function(){return{className:"image-properties",text:"Properties",tooltip:"Set additional image properties",click:function(h,b){a.trigger("analyticsEvent",{name:"confluence.editor.image-properties-trigger"});a.Confluence.PropertyPanel.destroy();d("#image-properties-dialog").remove();c=new a.ConfluenceDialog({id:"image-properties-dialog",
onSubmit:m});a.trigger("dialog-created.image-properties",{img:b});c.popup.element.attr("data-tab-default","0");c.addHeader("Image Properties");c.addSubmit("Save",m);c.addCancel("Cancel",o);for(var e=c,f=l(),g=0;g<f.length;g++){var j=f[g],k=i[j.key];k&&e.addPanel(j.label,k.content,k.panelClass,j.key)}1===f.length&&e.popup.element.find(".dialog-page-menu").show();a.trigger("dialog-before-show.image-properties");
c.show()}}}})))},registerPanel:function(a,b,c,d){i[a]={content:b,panelClass:c,saveFn:d}}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor/tinymce3/plugins/imageproperties/js/image-properties-dialog","Confluence.Editor.ImageProps",function(d){var a=require("ajs");a.toInit(d.init);a.bind("quickedit.success",d.init)});
}catch(e){WRMCB(e)};