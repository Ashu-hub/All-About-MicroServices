WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'de.scandio.confluence.plugins.pocketquery:pocketquery-macrobrowser-web-resources', location = '/pocketquery/js/pocketquery-macrobrowser.js' */
(function(e){var l,a;var h="pocketquery-macro-preview pocketquery";function c(m){if(m){l.addClass("loading")}else{l.removeClass("loading")}}function i(){var m={includechangetemplate:{or:["dynamicload","allowgetparams"]},includereloadbutton:{or:["dynamicload"]},disableautoload:{or:["dynamicload"]}};e.each(m,function(s,o){var r=e("#macro-param-div-"+s);var n=o.or?"or":"and";var q=o[n];var p=n==="and";e.each(q,function(t,w){var u=e("#macro-param-"+w);var v=u.is(":checked");if(v&&n==="or"){p=true;return false}else{if(!v&&n==="and"){p=false;return false}}});r[p?"addClass":"removeClass"]("visible")})}function g(p){var u=e("#macro-param-name");var q=e("#macro-param-div-parameters");var m=e('<select id="query-name-select">');var v=e('<ul id="pocket-param-list">');var t=AJS.params.contextPath+"/rest/pocketquery/1.0/view/get-all-queries";var s={queryName:null,params:[]};var o=function(y){e.each(y,function(A,z){var B;if(!e("#pocket-param-"+z).length){B=e("<li>").append('<label for="pocket-param-'+z+'">'+z+"</label>").append('<input data-key="'+z+'" type="text" class="text" id="pocket-param-'+z+'">');v.append(B)}})};var x=function(){var z=m.val();var y=a[z];u.val(z);u.change();q.find("li, span").remove();if(y.length){o(y)}else{q.append("<span>"+"There are no params for this statement."+"</span>")}if(z===s.queryName){e.each(s.params,function(C,B){var A=PocketQuery.decodeParameterValue(B.value);e("input#pocket-param-"+B.key).val(A)})}};var n=function(){if(p&&p.name){s.queryName=p.name;m.val(p.name).change();if(p.parameters){e.each(p.parameters.split("&"),function(A,C){var B=C.split("=");var z={key:B[0],value:B[1]};var y=PocketQuery.decodeParameterValue(z.value);s.params.push(z);e('input[id^="pocket-param"][data-key="'+z.key+'"]').val(y)})}}};var r=function(z){var A,y;if(e.isEmptyObject(z.data)){A="No queries found!";y="There were no queries found. Either there were no queries created for PocketQuery or another error occured. Please contact your administrator."}else{A="Cannot connect!";y="PocketQuery has no connection to your system, please reload this page and make sure youre logged in."}l.addClass("error");AJS.messages.error(".macro-input-fields",{title:A,body:y,id:"pocketquery-macrobrowser-error"})};var w=function(y){var z;if(!y.data||e.isEmptyObject(y.data)){r(y.data)}else{a=y.data;z=e.map(a,function(B,A){return A}).sort();q.append(v);e.each(z,function(A,B){m.append('<option data-name="'+B+'">'+B+"</option>")});u.after(m);x();m.change(function(){x()});m.auiSelect2();n()}i();c(false);m.focus()};c(true);l.removeClass("error");if(AJS.params.spaceKey){t+="?contextKey="+AJS.params.spaceKey}e.ajax(t,{success:w,error:r})}function b(){e(document).on("click","#macro-browser-dialog .pocket-param-help-link",function(n){var m=e(this).closest(".macro-param-div").find(".macro-param-desc");n.preventDefault();n.stopImmediatePropagation();m[m.hasClass("visible")?"removeClass":"addClass"]("visible")});e(document).on("change",".pocketquery-macro-preview input.checkbox",i)}function d(){var m="Loading PocketQuery data...";l.find(".dialog-title").append('<div class="pocket-loading"><p>'+m+"</p><div></div></div>");l.addClass(h);PocketQuery.hasPocketQueryAdminAccess(function(n){if(n){l.addClass("is-pocketquery-admin")}})}function k(m){l=e("#macro-browser-dialog");d();g(e.extend({},m));return m}function f(n){var p=[],o;var m=e("#pocket-param-list").find("input");if(m.length){m.each(function(){var r=e(this);var q=PocketQuery.encodeParameterValue(r.val());p.push(r.data("key")+"="+q)});o=p.join("&");e("#macro-param-parameters").val(o);n.parameters=o}return n}function j(n,m){if(m&&m.dialog&&m.dialog.activeMetadata&&m.dialog.activeMetadata.macroName==="pocketquery"){l.removeClass(h);l.find("#pocketquery-macrobrowser-error").remove()}}AJS.toInit(function(){AJS.MacroBrowser&&AJS.MacroBrowser.setMacroJsOverride("pocketquery",{beforeParamsSet:k,manipulateMarkup:f,updateMacroParametersForPreview:f});AJS.bind("hide.dialog",j);b()})}($||jQuery));
}catch(e){WRMCB(e)};